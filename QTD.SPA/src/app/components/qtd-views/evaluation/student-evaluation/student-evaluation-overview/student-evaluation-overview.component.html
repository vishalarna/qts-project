<app-header [toggleMenuIcon]="false" [canGoBack]="false" [breadcrumbs]="url" ></app-header>
<div class="flex flex-row flex-wrap ml-4 mt-3">
    <p class="font-bold text-lg">Student Evaluations</p>
</div>
<div class="px-6 pb-5 flex flex-row" style="margin-right: 2rem;">
  <app-data-loader *ngIf="isLoadingStats"></app-data-loader>
  <ng-container *ngIf="!isLoadingStats">
        <div class="container bg-white rounded m-3 pt-4 pb-3 shadow-sm w-full mb-4">
            <div class="flex flex-row ">
                <div class="flex flex-col" style="width:33vw ;">
                    <p>Total Published Student Evaluations</p>
                    <span (click)="openFlyInPanelList(list,'Publish')" [ngClass]="{'text-2xl text-qtd font-bold cursor-pointer':studentEvaluationStats?.studentEvaluationsPublished>0,'text-xl text-black':studentEvaluationStats?.studentEvaluationsPublished==0}">
                      {{studentEvaluationStats?.studentEvaluationsPublished | number : '2.0'}}</span>

                </div>
                <div class="flex flex-col " style="width:33vw;">
                    <p>Total In Development Student Evaluations</p>
                    <span (click)="openFlyInPanelList(list,'Development')" [ngClass]="{'text-2xl text-qtd font-bold cursor-pointer':studentEvaluationStats?.studentEvaluationsInDevelopment>0,'text-xl text-black':studentEvaluationStats?.studentEvaluationsInDevelopment==0}">
                      {{studentEvaluationStats?.studentEvaluationsInDevelopment | number : '2.0'}}</span>

                </div>
                <div class="flex flex-col " style="width:33vw;">
                    <p>Total Inactive Student Evaluations</p>
                    <span (click)="openFlyInPanelList(list,'Active')" [ngClass]="{'text-2xl text-red-600 font-bold cursor-pointer':studentEvaluationStats?.studentEvaluationsInActive>0,'text-xl text-black':studentEvaluationStats?.studentEvaluationsInActive==0}">
                      {{studentEvaluationStats?.studentEvaluationsInActive | number : '2.0'}}</span>

                </div>
            </div>

        </div>
    </ng-container>

</div>
<div class="flex flex-row flex-wrap ml-4 mt-3">


</div>
<div class="flex w-full pr-5 justify-between">
  <app-button variant="text" class="mt-2" text="Bulk Edit" icon="edit" iconPosition="left" style="margin-left: 3rem;"  (click)="BulkEditStudentEvaluation()"></app-button>
    <div class="flex">
      <div class="flex mr-2">
        <app-button
          class="mr-2"
          color="secondary"
          text="Filters"
          size="sm"
          leftIcon="filter_alt"
          rightIcon="expand_more"
          [matMenuTriggerFor]="addEmpMenu"
        >
        </app-button>
        <mat-menu #addEmpMenu="matMenu">
          <label mat-menu-item (click)="dataSourceStatusFilter('Inactive');filterName='Inactive'"
            >Inactive</label
          >
          <label mat-menu-item (click)="dataSourceStatusFilter('Active');filterName='Active'">Active</label>
        </mat-menu>

      </div>
    <app-button color="secondary" text="View Question Bank" size="sm" (clicked)="OpenQuestionBank()">
    </app-button>
      <app-button
        text="Add New Evaluation"
        size="sm"
        class="ml-2"
        (clicked)="CreateNewEvaluation()"
      >
      </app-button>


    </div>
  </div>

  <div class="flex flex-row justify-between ml-12 px-4 py-2 bg-white-one w-1/5 pt-2" *ngIf="filterName">
    <p>{{filterName}} Filter Applied</p>

  </div>
  <!-- <div class="flex flex-row justify-end space-x-4 text-sm px-12 mb-3"> -->


  <div
    class="flex-row bg-white-one rounded-b-md ml-5 mr-5 shadow-sm"
  >
    <!-- <div class="border-gray-one shadow-xs border-0.5 rounded mat-elevation-z8"> -->
    <div class="flex flex-col mt-3">
      <!-- search and buttons starts -->
      <div
        class="
          flex flex-row
          bg-white-one
          rounded-t-md
          py-4
          px-6
          space-x-2
          border-b-0.8 border-gray-one
          w-full
        "
      >
        <svg
          class="flex-none w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          ></path>
        </svg>
        <input
          class="text-sm flex-grow focus:outline-none"
          placeholder="Enter keywords to search"
          (keyup)="filterEvaluation($event)" [(ngModel)]="clearSearch"/>
          <app-icon icon="close" class="cursor-pointer" (click)="clearFilter()"></app-icon>

        <div class="flex flex-row space-x-4 text-sm"></div>
      </div>
    </div>
    <app-data-loader *ngIf="isLoading"></app-data-loader>
        <div class="border-gray-one shadow-xs border-0.5 rounded mat-elevation-z8" *ngIf="dataSource && !isLoading">

            <mat-table [dataSource]="dataSource" *ngIf="dataSource" matSort (matSortChange)="sortData($event)">

                <ng-container matColumnDef="studentEvaluationId">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Student Evaluation ID </mat-header-cell>
                    <mat-cell *matCellDef="let row"> {{row.studentEvaluationId}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="title">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Student Evaluation Title </mat-header-cell>
                    <mat-cell *matCellDef="let row"> {{row.title}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="questionsNum">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Total Questions </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <div class="flex flex-col">
                            <span>{{row.questionsNum}}</span>
                            <!-- <span class="mt-2">{{row.modifyDate | date:'medium' }}</span> -->
                        </div>
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="active">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Inactive/Active </mat-header-cell>
                  <mat-cell *matCellDef="let row">

                    <p class="rounded-sm text-xs text-green-700 font-medium pt-2 pb-2 mt-2 inactive" style="width:8rem;text-align: center;" *ngIf="row.active === false">
                    <span>Inactive</span></p>
                    <p class="rounded-sm text-xs text-green-700 font-medium pt-2 pb-2 mt-2 inactive" style="width:8rem;text-align: center;" *ngIf="row.active === true">
                      <span>Active</span></p>
                  </mat-cell>
                </ng-container>


                <ng-container matColumnDef="symbol">
                    <mat-header-cell *matHeaderCellDef mat-sort-header (click)="toggleSortOrder(); dataSource.data = sortStudentEvaluationStatus(dataSource.data)"> Status </mat-header-cell>
                    <mat-cell *matCellDef="let row">
          <p class="rounded-sm text-xs text-green-700 font-medium pt-2 pb-2 mt-2 publish" style="width:8rem;text-align: center;" *ngIf="row.isPublished === true">
          <span>Published</span></p>

          <p class="rounded-sm text-xs text-green-700 font-medium pt-2 pb-2 mt-2 develop" style="width:8rem;text-align: center;" *ngIf="row.isPublished === false || row.isPublished === null && row.active != false"
          >
          <span>Draft</span></p>
                    </mat-cell>
                </ng-container>



                <ng-container matColumnDef="id">
                    <mat-header-cell *matHeaderCellDef></mat-header-cell>
                    <mat-cell *matCellDef="let row">
                      <div class="flex flex-row items-center text-gray-four btn-group">
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                          <app-icon icon="more_horiz"></app-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                          <!--     <label (click)="openEmpPage('view',row.id)" mat-menu-item translate>L.Open</label> -->
                          <label
                          mat-menu-item
                          translate
                          [disabled]="row.active === false"
                          (click)="EditNewEvaluation(row.id)"
                          > Edit</label
                        >
                          <label
                            mat-menu-item
                            translate
                            [disabled]="row.active === false"
                            (click)="openFlyInPanel(openEditCopyEvaluation,row.id,'Edit')"
                            >Quick Edit</label
                          >
                          <label
                            mat-menu-item
                            translate
                            (click)="openFlyInPanel(openEditCopyEvaluation,row.id,'Copy')"
                            [disabled]="row.active === false"
                            >Copy</label
                          >
                          <label
                            mat-menu-item
                            translate
                            [disabled]="row.active === false || row.classRoaster > 0"
                            (click)="deleteStudentEvaluation(unlinkModal, row)"
                            >Delete</label
                          >

                          <div class=" flex flex-row">
                            <label
                            mat-menu-item
                            translate
                            (click)="changeStatus(statusModal,row)"
                            [disabled]="row.classRoasterIsReleased"
                            >{{ row.active === true ? "Make Inactive" : "Make Active" }}</label
                          >
                          <app-icon *ngIf="row.classRoasterIsReleased" class="pt-2"
                          matTooltip="The Make Inactive option is not available due to linked data in EMP" icon="help"></app-icon>
                          </div>

                        </mat-menu>
                      </div>
                    </mat-cell>
                  </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

                <!-- Row shown when there is no matching data.-->
                <tr class="mat-row flex text-center " *matNoDataRow>
                    <td class="mat-cell w-full m-2">No data matching the filter</td>
                </tr>
            </mat-table>

            <!-- <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons
                aria-label="Select page of periodic elements">
            </mat-paginator> -->


        </div>

    <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons
                      aria-label="Select page of training programs">
                  </mat-paginator>

    <!-- </div> -->
  </div>

  <ng-template #openEditCopyEvaluation>
    <app-fly-panel-edit-evaluation (closed)="flyPanelService.close()" [studentEvalId]="studentEvalId" [mode]="mode" (refresh)="getAllEvaluations()">
    </app-fly-panel-edit-evaluation>
  </ng-template>

  <ng-template #statusModal>
    <app-qtd-dialogue [header]="modalHeader" [description]="modalDescription" cancelText="No" confirmText="Yes"
        [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="MakeActive($event,!isActive)">
    </app-qtd-dialogue>
  </ng-template>

    <ng-template #unlinkModal>
      <app-qtd-dialogue header="Delete Student Evaluation" [description]="deleteDescription" cancelText="No"
        confirmText="Yes" [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="Delete($event)">
      </app-qtd-dialogue>
    </ng-template>

    <ng-template #list>
      <app-fly-panel-student-evaluation-list [moduleName]="moduleName"></app-fly-panel-student-evaluation-list>
    </ng-template>
