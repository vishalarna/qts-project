<div class="flex flex-row justify-between items-center px-12 mt-5 mb-3">
  <p class="text-xl font-bold text-gray-900 mb-0">Tool Operation</p>
  <app-button
    (click)="closeFlyPanel()"
    ButtonType="icon"
    icon="close"
  ></app-button>
</div>
<div *ngIf = "isLoading" class="operation-spinner">
  <app-spinner></app-spinner>
</div>
<div class="m-3" [formGroup]="toolOperationForm" *ngIf = "!isLoading" >
  <div class="flex flex-col ml-5 mt-3">
    <app-label text="Operation Type" class="font-weight-bold label required"></app-label>
    <mat-select placeholder = "Select Operation Type"
      formControlName="operation"
      (selectionChange)="onOperationTypeChange($event.value)"
      class="appearance-none rounded border w-full px-4 py-2.5 mt-2"
    >
      <mat-option *ngFor="let item of operationType" [value]="item.id">
        {{ item.type }}
      </mat-option>
    </mat-select>
  </div>

  <ng-container *ngIf="toolOperationForm.get('operation').value">
    <div class="flex flex-col ml-5 mt-3">
      <app-label text="{{('Tool' | labelReplacement)| async}}" class="font-weight-bold label required"></app-label>
      <ng-container *ngIf="operationTypeName == 'CreateLink'">
        <mat-select placeholder = "Select {{('Tool' | labelReplacement)| async}}" #select="matSelect"
          formControlName="tool"
          class="appearance-none rounded border w-full px-4 py-2.5 mt-2"
        >
        <input matInput class="pt-3 pb-3 pl-3 w-100" type="text" placeholder="Enter Text to Search" formControlName="searchText" (input)="toolSearch()" (blur) = "resetSearch()" (keydown)="handleKeydown($event)">
          <ng-container *ngFor="let tc of filteredTools">
            <mat-option
              *ngFor="let tt of getFilteredTools(tc.tools)"
              [value]="tt.id"
              >{{ tc.title }} - {{ tt.number }} - {{ tt.name }}</mat-option
            >
          </ng-container>
        </mat-select>
      </ng-container>
    <ng-container *ngIf="operationTypeName == 'RemoveLink'">
      <mat-select placeholder = "Select {{('Tool' | labelReplacement)| async}}" #select="matSelect"
        formControlName="tool"
        class="appearance-none rounded border w-full px-4 py-2.5 mt-2">
        <input matInput class="pt-3 pb-3 pl-3 w-100" type="text" placeholder="Enter Text to Search" formControlName="searchText" (input)="toolSearch()" (blur) = "resetSearch()" (keydown)="handleKeydown($event)">
        <mat-option *ngFor="let tt of filtered_taskTool" [value]="tt.id">{{tt.toolCategory.title}} - {{tt.number}} - {{tt.name}}</mat-option>
      </mat-select>
    </ng-container>
  </div>
    <div class="flex justify-end mt-3">
      <app-button
        size="sm"
        text="Save"
        [disabled]="saveDisabled()"
        (clicked)="onToolOperationSave()"
        type="submit"
      ></app-button>
    </div>
  </ng-container>
</div>
