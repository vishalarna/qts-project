<div>
  <div class="flex flex-row justify-between items-center px-12 mt-5">
    <p class="text-xl font-bold text-gray-900">
      Select {{ "Task" | labelReplacement | async }}s
    </p>
    <app-button
      (click)="flyPanelSrvc.close()"
      ButtonType="icon"
      icon="close"
    ></app-button>
  </div>

  <div class="mt-4 flex flex-row justify-around px-12 w-100" *ngIf="linkedIds.length > 0">
    <div class=" flex flex-col flex-wrap bg-gray-one mb-3 mt-3 px-3 py-3 rounded w-100 " >
      <div class="flex flex-row w-full justify-between align-items-center">
        <p class="text-xs text-gray-four pt-2">
          {{
            linkedIds.length +
              " " +
              ("Task" | labelReplacement | async) +
              "(s) selected to add to Review"
          }}
        </p>
        <app-button
          (clicked)="addTaskToTaskListReview()"
          class="mb-2"
          type="button"
          color="secondary"
          size="sm"
          text="Add to Review"
        >
        </app-button>
      </div>
    </div>
  </div>

  <div class=" flex flex-row items-center bg-white-one rounded-t-md py-4 mx-12 space-x-2 border-b-0.8 border-gray-one " >
    <svg class="flex-none w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" ></path>
    </svg>
    <input (keyup)="searchTask($event)"
      class="text-sm flex-grow focus:outline-none" placeholder="Search" type="text" [value]="searchText"/>
      <div class="flex flex-row space-x-4 text-sm">
        <app-button color="secondary" text="Filter" size="sm" icon="filter_alt" iconPosition="left" [matMenuTriggerFor]="filterMenu" >
        </app-button>
        <mat-menu #filterMenu="matMenu">
          <label  mat-menu-item (click) = "filterBy('all')">All</label>  
          <label  mat-menu-item (click) = "filterBy('rr')">RRT Only</label>  
          <label  mat-menu-item (click) = "filterBy('non-rr')">Non-RRT Only</label>  
          <label  mat-menu-item (click) = "filterBy('meta')">Meta Tasks Only</label>  
        </mat-menu>
      </div>
  </div>

  <div *ngIf="isTaskLoading" class="task-spinner">
    <app-spinner></app-spinner>
  </div>
  <ng-container *ngIf="taskDataSource.data.length == 0 && !isTaskLoading">
    <div class="text-center mt-5">
        No Data Found
    </div>
</ng-container>
<ng-container *ngIf="taskDataSource.data.length > 0 && !isTaskLoading">
    <div class="flex flex-col mx-12">
      <mat-checkbox class="px-3 m-2" (change)="masterToggle()" [checked]="taskCheckListSelection.hasValue() && isAllSelected()"
        [indeterminate]="taskCheckListSelection.hasValue() && !isAllSelected()">
        Select All {{("Task" | labelReplacement) | async}}s
      </mat-checkbox>
        <mat-tree [dataSource]="taskDataSource" [treeControl]="treeControl" class="qtd-tree">
            <!-- This is the tree node template for leaf nodes -->
            <!-- There is inline padding applied to this node using styles.
                    This padding value depends on the mat-icon-button width. -->
            <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding [style.display]="showOnlySelected && !node.selected || hideLeafNode(node) ? 'none' : 'block'">
              <ng-container *ngIf="node.checkbox">
                <mat-checkbox (change)="onTaskChange($event,node)" [checked]="node.selected">
                   {{node.description}}</mat-checkbox>
              </ng-container>
              <ng-container *ngIf="!node.checkbox">
                <app-icon style="color: rgb(92, 155, 49);" icon="link"></app-icon>&nbsp;<span
                  style="color: rgb(92, 155, 49);">{{node.description}}</span>
              </ng-container>
            </mat-tree-node>

            <!-- This is the tree node template for expandable nodes -->
            <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild" [style.display]="showOnlySelected && !(node.selected || node.indeterminate) || hideParentNode(node) ? 'none' : 'block'">
              <div class="mat-tree-node">
                <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.description">
                  <app-icon [icon]="treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'">
                  </app-icon>
                </button>

                <mat-checkbox [checked]="node.selected" [indeterminate]="node.indeterminate && !node.selected"
                  (change)="itemToggle($event.checked,node)">{{node.description}}</mat-checkbox>
              </div>

              <div *ngIf="treeControl.isExpanded(node)" role="group">
                <ng-container matTreeNodeOutlet></ng-container>
              </div>
            </mat-nested-tree-node>
        </mat-tree>

    </div>
</ng-container>

</div>
