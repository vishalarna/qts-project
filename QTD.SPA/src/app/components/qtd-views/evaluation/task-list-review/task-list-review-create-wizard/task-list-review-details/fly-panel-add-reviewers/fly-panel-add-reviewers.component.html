<div *ngIf="!isFlyPanelAddNewQTDUser">
  <div class="flex flex-row justify-between items-center px-12 mt-5 mb-4">
    <p class="text-xl font-bold text-gray-900 mb-0">
      Add {{ "Task" | labelReplacement | async }} List Review Participants
    </p>
    <app-button
      (click)="closeFlyPanel()"
      ButtonType="icon"
      icon="close"
    ></app-button>
  </div>
<div class=" flex flex-row items-center bg-white-one rounded-t-md py-4 mx-12 space-x-2 border-b-0.8 border-gray-one " >
    <svg class="flex-none w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" ></path>
    </svg>
    <input (keyup)="searchQTDUsers($event)"
      class="text-sm flex-grow focus:outline-none" placeholder="Search" type="text"/>
    <div class="d-flex justify-content-end mb-4 mx-12">
      <app-button
        text="Create QTD User"
        size="sm"
        color="secondary"
        (clicked)="openAddNewReviewerFlyPanel()"
      ></app-button>
    </div>
  </div>

  <div class="flex flex-row items-start bg-white-one rounded-t-md py-4 mx-12 space-x-4 border-b-0.8 border-gray-one">
    <div class="w-1/2">
      <label>Organization</label>
      <mat-form-field appearance="outline" class="w-full mt-2">
        <mat-select
          placeholder="Select Organization"
          [value]="selectedOrganization"
          (selectionChange)="setDropdownValue($event, 'organization')"
        >
          <input
            matInput
            type="text"
            placeholder="Enter Text to Search"
            [(ngModel)]="organizationSearchText"
            (keyup)="filterOrganizations()"
            class="w-full py-2 px-3 text-sm block"
          />

          <mat-option *ngFor="let org of filteredOrganizations" [value]="org">
            {{ org.name }}
          </mat-option>
        </mat-select>

        <button
          *ngIf="selectedOrganization"
          matSuffix
          mat-icon-button
          type="button"
          aria-label="Clear"
          (click)="clearOrganization(); $event.stopPropagation()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="w-1/2">
      <label>{{('Position' | labelReplacement)| async}}</label>
      <mat-form-field appearance="outline" class="w-full mt-2">
        <mat-select
          placeholder="Select {{('Position' | labelReplacement)| async}}"
          [value]="selectedPosition"
          (selectionChange)="setDropdownValue($event, 'position')"
        >
          <input
            matInput
            type="text"
            placeholder="Enter Text to Search"
            [(ngModel)]="positionSearchText"
            (keyup)="filterPositions()"
            class="w-full py-2 px-3 text-sm block"
          />

          <mat-option *ngFor="let pos of filteredPositions" [value]="pos">
            {{ pos.positionTitle }}
          </mat-option>
        </mat-select>

        <button
          *ngIf="selectedPosition"
          matSuffix
          mat-icon-button
          type="button"
          aria-label="Clear"
          (click)="clearPosition(); $event.stopPropagation()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <div
    class="mt-4 flex flex-row justify-around px-12 w-100"
    *ngIf="selection.selected.length > 0"
  >
    <div
      class="
        flex flex-col flex-wrap
        bg-gray-one
        mb-3
        mt-3
        px-3
        py-3
        rounded
        w-100
      "
    >
      <div class="flex flex-row w-full justify-between align-items-center">
        <p class="text-xs text-gray-four pt-2">
          {{
            selection.selected.length + " QTD User(s) selected to add as List Review Participant(s) for the " +  ('Task' | labelReplacement | async)  + " List Review"
          }}
        </p>
        <app-button
          (clicked)="linkToReview()"
          class="mb-2"
          type="button"
          color="secondary"
          size="sm"
          text="Link to {{ 'Task' | labelReplacement | async }} List Review"
        >
        </app-button>
      </div>
    </div>
  </div>

  <app-data-loader *ngIf="!reviewerData"></app-data-loader>
  <div *ngIf="reviewerData" class="flex flex-col reviewer-list-data mb-3 mx-12">
    <mat-table
      matSort
      class="w-full"
      style="border-top: 0.8px solid #e1e5e4; width: 100%"
      mat-table
      [dataSource]="reviewerDataSource"
    >
      <ng-container matColumnDef="id">
        <mat-header-cell *matHeaderCellDef class="table-reviewer">
          <mat-checkbox
            (change)="$event ? masterToggle() : null"
            [checked]="isAllSelected()"
            [indeterminate]="isSomeSelected()"
            class="mr-3"
          ></mat-checkbox>
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="table-reviewer">
          <mat-checkbox
            *ngIf="!isLinked(row.id)"
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          ></mat-checkbox>
          <app-icon
            *ngIf="isLinked(row.id)"
            class="mr-2"
            style="color: rgb(92, 155, 49)"
            icon="link"
          ></app-icon>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="allReviewers">
        <mat-header-cell *matHeaderCellDef class="px-2">
          <span class="font-bold text-gray-500 reviewer-header"
            >All QTD Users</span
          >
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <img
            style="border-radius: 50%; width: 50px; height: 50px"
            class="img-fluid mr-2 mt-2 ml-2 mb-2"
            [src]="row.image"
            onerror="this.src='assets/img/ImageNotFound.jpg'"
          />
          <div [ngClass]="{ 'linked-row': isLinked(row.id) }">
            <div class="font-bold mb-1 reviewer-name">
              {{ row.person?.firstName }} {{ row.person?.lastName }}
            </div>
            <div
              [ngClass]="{ 'linked-row': isLinked(row.id) }"
              class="text-gray-500"
            >
              {{ row.person?.username }}
            </div>
          </div>
        </mat-cell>
      </ng-container>
      <mat-header-row
        class="pl-2 pr-2"
        *matHeaderRowDef="displayedColumns"
      ></mat-header-row>
      <mat-row
        class="pr-2 pl-2"
        *matRowDef="let row; columns: displayedColumns"
      ></mat-row>

      <tr class="no-data-mat-row flex text-center" *matNoDataRow>
        <td class="mat-cell w-full m-2">No data to display</td>
      </tr>
    </mat-table>
  </div>
</div>

<app-fly-panel-create-qtd-user
  *ngIf="isFlyPanelAddNewQTDUser"
  (closed)="closeNewReviewerFlyPanel($event)"
  (newReviewers)="getNewReviewers($event)"
></app-fly-panel-create-qtd-user>
