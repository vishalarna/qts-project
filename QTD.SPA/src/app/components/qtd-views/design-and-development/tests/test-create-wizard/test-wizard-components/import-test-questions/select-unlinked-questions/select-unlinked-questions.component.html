<mat-toolbar class="h-28 app-toolbar-sticky">

    <app-button type="button" ButtonType='icon' icon='arrow_back' (clicked)="goBack()">
    </app-button>

    <h1 class="flex-auto font-medium text-xl" id="title" translate>Select Unlinked Questions</h1>
    <div class="flex flex-row items-center space-x-4">

      <app-button [spinner]="showSpinner" color="secondary"
       type="button" text="Cancel" (clicked)="goBack()">
      </app-button>

    </div>
</mat-toolbar>

<div class="flex flex-col p-4 pl-5">
    <section class="flex flex-col bg-white rounded shadow-sm mt-4">
        <div class="pl-3 pt-3 m-0 flex flex-row justify-between"
          style="align-items: baseline;border-bottom: 2px solid #F2F2F2;">
          <mat-form-field class="flex flex-grow bg-white" appearance="outline">
            <mat-icon matPrefix>search</mat-icon>
            <input (input)="filterData()" [(ngModel)]="filterString" type="text" matInput
              placeholder="Enter keywords to search">
          </mat-form-field>

        </div>

        <div class="flex flex-row flex-wrap bg-gray-one justify-between mb-3 mt-3  px-3 py-3 rounded"
          *ngIf="linkIds.length > 0">
          <p class="text-xs text-gray-four pt-2">{{linkIds.length}} Test Questions have been selected</p>
          <app-button  [spinner]="isLinkingTestItem" [disabled]="isLinkingTestItem"
             size="sm" color="secondary" (clicked)="linkTestItems()" text="Import to Test">
          </app-button>
        </div>
        <app-data-loader *ngIf="isLoading"></app-data-loader>
        <div [hidden]="isLoading">
          <table matSort mat-table class="w-full" [dataSource]="dataSource">
            <ng-container  matColumnDef="cb">
              <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
              </th>
              <td mat-cell *matCellDef="let row">
                <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selectrow(row) : null"
                [checked]="selection.isSelected(row)"></mat-checkbox>
              </td>
            </ng-container>

            <ng-container matColumnDef="number">
              <th mat-sort-header [ngClass]="{'pl-3': selectedId}" mat-header-cell *matHeaderCellDef>
                ID
              </th>
              <td  [ngClass]="selection.selected.includes(row) ? 'greenText':''" [ngClass]="{'pl-3': selectedId}" mat-cell *matCellDef="let row">
                {{row.number}}
              </td>
            </ng-container>

            <ng-container matColumnDef="question">
              <th mat-sort-header mat-header-cell *matHeaderCellDef>
                Question Stem
              </th>
              <td [ngClass]="selection.selected.includes(row) ? 'greenText':''" style="width: 30%;word-wrap: break-word;" class="pt-3" mat-cell *matCellDef="let row">
                <p [innerHTML]="row.question"></p>
              </td>
            </ng-container>
            <ng-container matColumnDef="type">
              <th mat-sort-header mat-header-cell *matHeaderCellDef>
                Type
              </th>
              <td [ngClass]="selection.selected.includes(row) ? 'greenText':''" mat-cell *matCellDef="let row">
                {{row.type}}
              </td>
            </ng-container>
            <ng-container matColumnDef="taxonomy">
              <th mat-sort-header mat-header-cell *matHeaderCellDef>
                Taxonomy Level
              </th>
              <td [ngClass]="selection.selected.includes(row) ? 'greenText':''" mat-cell *matCellDef="let row">
                {{row.taxonomy}}
              </td>
            </ng-container>
            <ng-container matColumnDef="status">
              <th mat-sort-header mat-header-cell *matHeaderCellDef>

              </th>
              <td mat-cell *matCellDef="let row">
                <div class="flex w-full">
                    <app-button  ButtonType="button" variant="text" [icon]="'visibility'" iconPosition="left" text="Preview"
                      (clicked)="openFlyInPanel(previewTestQuestion)"
                      (clicked)="selectedRow = row;openPreviewFlyInPanel(previewTestQuestion, row)"></app-button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns : displayedColumns">
            </tr>
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
                No data Found.
              </td>
            </tr>
          </table>
        </div>
        <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
        </mat-paginator>
    </section>
</div>

<ng-template #previewTestQuestion>
    <app-flypanel-preview-test-questions (closed)="close()" [previousQuestion]="selectedRow"></app-flypanel-preview-test-questions>
</ng-template>
