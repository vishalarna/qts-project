<div class="m-5 flex flex-col">
  <!-- Header Section -->
  <section class="flex flex-row justify-between" style="align-items: center;">
    <div class="flex flex-row" style="align-items: center;">
      <mat-icon (click)="closed.emit('fp-add-eo')" class="mr-2 cursor-pointer"
        style="color:#5C9B31">keyboard_arrow_left</mat-icon>
      <p class="font-bold text-lg m-0 p-0">Select {{("Enabling Objective" | labelReplacement)| async}} For Test Item</p>
    </div>
    <mat-icon class="cursor-pointer" (click)="closed.emit('fp-add-eo')">
      close
    </mat-icon>
  </section>

  <!-- Search and filter Section -->
  <app-data-loader *ngIf="isLoading"></app-data-loader>
  <section *ngIf="!isLoading" class="flex flex-col mt-5" style="margin-left: 0.9rem !important;">
    <div class="flex flex-row w-full pb-2" style="border-bottom: 1px solid lightgray;">
      <mat-icon style="color:gray;padding-right: 2rem;">search</mat-icon>
      <input [(ngModel)]="filterEOString" (ngModelChange)="filterDataNew(showActive)" type="text" placeholder="Search"
        style="outline:none;" class="w-full">
    </div>
    <div class="flex flex-row" style="align-items: center;">
      <span class="text-gray-500 font-normal">Showing : {{showActive ? "Active":"Inactive"}} EOs </span>
      <!-- <mat-icon [matMenuTriggerFor]="activeFilter" class="text-gray-500 cursor-pointer">keyboard_arrow_down</mat-icon> -->
    </div>
    <!-- <mat-menu #activeFilter="matMenu">
      <label (click)="filterDataNew(true)" class="label_style" *ngIf="!showActive" mat-menu-item>Active</label>
      <label (click)="filterDataNew(false)" class="label_style" *ngIf="showActive" mat-menu-item>Inactive</label>
    </mat-menu> -->
    <div *ngIf="selection.selected.length > 0" class="flex flex-row" style="justify-content: flex-end;">
      <app-button (clicked)="idSelected.emit(selection.selected[0])" size="sm" ButtonType="button" color="secondary"
        text="Select Marked EO"></app-button>
    </div>
  </section>

  <!-- Tree Section -->
  <section *ngIf="!isLoading" class="mt-4" style="margin-left: 0.9rem !important;">
    <app-spinner *ngIf="dataSourceWithTopic.data === undefined"></app-spinner>
    <ng-container *ngIf="dataSourceWithTopic.data.length < 1">
      <div>No Data Found</div>
    </ng-container>
    <div *ngIf="dataSourceWithTopic" class="flex flex-col">
      <mat-tree [dataSource]="dataSourceWithTopic" [treeControl]="treeControl" class="qtd-tree">
        <!-- This is the tree node template for leaf nodes -->
        <!-- There is inline padding applied to this node using styles.
                  This padding value depends on the mat-icon-button width. -->
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
          <ng-container *ngIf="node.checkbox">
            <mat-checkbox [checked]="selection.selected.includes(node)" (change)="onEOChange($event,node)">
              {{node.description}} 
              <span *ngIf="node.IsMetaEO"
              class="ml-1 qtd-meta-box p-1 font-bold">{{'META'|uppercase}}</span>
              <span *ngIf="node.IsEO"
              class="ml-1 qtd-meta-box p-1 font-bold">{{(node.IsSkillQualification ? 'SQ' : 'EO')|uppercase}}</span>
              </mat-checkbox>
          </ng-container>
          <ng-container *ngIf="node.checkbox !== undefined && !node.checkbox">
            <app-icon style="color: rgb(92, 155, 49);" icon="link"></app-icon>&nbsp;<span
              style="color: rgb(92, 155, 49);">{{node.description}}</span>
          </ng-container>
          <ng-container *ngIf="node.checkbox === undefined">
            <span style="color:black;">{{node.description}}</span>
          </ng-container>
          <!-- <ng-container *ngIf="!node.checkbox && filtered(node) && node.HasChild">
                      <span>{{node.description}}</span>
                    </ng-container> -->
        </mat-tree-node>

        <!-- This is the tree node template for expandable nodes -->
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
          <div class="mat-tree-node">
            <button style="outline:none;" mat-icon-button matTreeNodeToggle
              [attr.aria-label]="'Toggle ' + node.description">
              <mat-icon style="margin-top:0.5rem;">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'expand_less'}}
              </mat-icon>
            </button>

            <mat-checkbox *ngIf="!node.children">{{node.description}}</mat-checkbox>
            <span *ngIf="node.children">{{node.description}}</span>
          </div>

          <div [class.qtd-tree-invisible]="!treeControl.isExpanded(node)" role="group">
            <ng-container matTreeNodeOutlet></ng-container>
          </div>
        </mat-nested-tree-node>
      </mat-tree>

    </div>
  </section>
</div>
