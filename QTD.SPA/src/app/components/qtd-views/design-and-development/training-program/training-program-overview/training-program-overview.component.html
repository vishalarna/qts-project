<div class="flex flex-row flex-wrap ml-4 mt-3">
  <p class="font-bold text-lg">Training Programs</p>
</div>
<div class="px-10 pb-12 flex flex-row">
  <app-data-loader *ngIf="isLoadingStats"></app-data-loader>
  <ng-container *ngIf="!isLoadingStats">
    <div
      class="container bg-white rounded m-3 pt-3 pl-3 shadow-sm w-fit mb-4"
      style="width: 30vw"
    >
      <div class="mb-4">Total no. of Initial Training Programs</div>
      <div class="flex flex-row">
        <div class="flex flex-col" >
          <span [ngClass]="{'text-xl text-qtd font-bold cursor-pointer':trainingProgramsVM.initialTrainingProgramActive>0,'text-lg text-black':trainingProgramsVM.initialTrainingProgramActive==0}" (click)="trainingProgramsVM.initialTrainingProgramActive>0 && openFlyInPanel(ActiveInactiveList,'Initial Training Program',true)">

            <b>{{ trainingProgramsVM.initialTrainingProgramActive }}</b></span>
          <p>Active</p>
        </div>
        <span class="pl-3 pr-3"></span>
        <div class="flex flex-col">
          <span [ngClass]="{'text-xl text-red-600 font-bold cursor-pointer':trainingProgramsVM.initialTrainingProgramInActive>0,'text-lg text-black':trainingProgramsVM.initialTrainingProgramInActive==0}" (click)="trainingProgramsVM.initialTrainingProgramInActive>0 && openFlyInPanel(ActiveInactiveList,'Initial Training Program',false)"><b>
            {{ trainingProgramsVM.initialTrainingProgramInActive}}</b>
            </span>
          <p>Inactive</p>
        </div>
      </div>
    </div>

    <div
      class="container bg-white rounded m-3 pt-3 pl-3 shadow-sm w-fit mb-4"
      style="width: 30vw"
    >
      <div class="mb-4">Total no. of Continuing Training Programs</div>
      <div class="flex flex-row">
        <div class="flex flex-col">
          <span [ngClass]="{'text-xl text-qtd font-bold cursor-pointer':  trainingProgramsVM.continuingTrainingProgramActive>0,'text-lg text-black':  trainingProgramsVM.continuingTrainingProgramActive==0}" (click)="trainingProgramsVM.continuingTrainingProgramActive>0 && openFlyInPanel(ActiveInactiveList,'Continuing Training Program',true)"
            ><b>{{
              trainingProgramsVM.continuingTrainingProgramActive
            }}</b></span
          >
          <p>Active</p>
        </div>
        <span class="pl-3 pr-3"></span>
        <div class="flex flex-col">
          <span [ngClass]="{'text-xl text-red-600 font-bold cursor-pointer':trainingProgramsVM.continuingTrainingProgramInActive>0,'text-lg text-black':trainingProgramsVM.continuingTrainingProgramInActive==0}"   (click)="trainingProgramsVM.continuingTrainingProgramInActive>0 && openFlyInPanel(ActiveInactiveList,'Continuing Training Program',false)"
            ><b>{{
              trainingProgramsVM.continuingTrainingProgramInActive
            }}</b></span
          >
          <p>Inactive</p>
        </div>
      </div>
    </div>
    <div
      class="container bg-white rounded m-3 pt-3 pl-3 shadow-sm w-fit mb-4"
      style="width: 30vw"
    >
      <div class="mb-4">Total no. of Cycle Training Programs</div>
      <div class="flex flex-row">
        <div class="flex flex-col">
          <span  [ngClass]="{'text-xl text-qtd font-bold cursor-pointer':trainingProgramsVM.cycleTrainingProgramActive>0 ,'text-lg text-black':trainingProgramsVM.cycleTrainingProgramActive==0}" (click)="trainingProgramsVM.cycleTrainingProgramActive>0 && openFlyInPanel(ActiveInactiveList,'Cycle Training Program',true)"
            ><b>{{ trainingProgramsVM.cycleTrainingProgramActive }}</b></span
          >
          <p>Active</p>
        </div>
        <span class="pl-3 pr-3"></span>
        <div class="flex flex-col">
          <span [ngClass]="{'text-xl text-red-600 font-bold cursor-pointer':trainingProgramsVM.cyclelTrainingProgramInActive>0 ,'text-lg text-black':trainingProgramsVM.cyclelTrainingProgramInActive==0}" (click)="trainingProgramsVM.cyclelTrainingProgramInActive>0 && openFlyInPanel(ActiveInactiveList,'Cycle Training Program',false)"
            ><b>{{ trainingProgramsVM.cyclelTrainingProgramInActive }}</b></span
          >
          <p>Inactive</p>
        </div>
      </div>
    </div>
  </ng-container>
</div>
<div class="flex w-full pr-5" style="justify-content: flex-end;">
  <!-- <app-button
    variant="text"
    class="mt-2"
    text="Bulk Edit"
    icon="edit"
    iconPosition="left"
    routerLink="/my-data/bulkedit/employees"
  ></app-button> -->
  <div class="flex">
    <app-button
      class="mr-2"
      color="secondary"
      text="Filters"
      size="sm"
      leftIcon="filter_alt"
      rightIcon="expand_more"
      [matMenuTriggerFor]="addEmpMenu"
    >
    </app-button>
    <app-button
      text="New Training Program "
      size="sm"
      icon="add"
      iconPosition="left"
      (clicked)="CreateTrainingProgram()"
    >
    </app-button>
    <mat-menu #addEmpMenu="matMenu">
      <label mat-menu-item (click)="openFlyPanel(filterByPosition,'Position')"
        >{{("Position" | labelReplacement)| async}}s</label
      >
      <button mat-menu-item [matMenuTriggerFor]="traingProgramTypeMenu">
        Training Program type
      </button>
      <label mat-menu-item (click)="openFlyPanel(filterByYear,'Year')">Year</label>
    </mat-menu>
    <mat-menu #traingProgramTypeMenu="matMenu">
      <label
        mat-menu-item
        (click)="getFilteredTrainingProgram('Initial Training Program');filterCheck=true"
        >Initial</label
      >
      <label
        mat-menu-item
        (click)="getFilteredTrainingProgram('Continuing Training Program');filterCheck=true"
        >Continuing</label
      >
      <label
        mat-menu-item
        (click)="getFilteredTrainingProgram('Cycle Training Program');filterCheck=true"
        >Cycle</label
      >
    </mat-menu>
  </div>
</div>
<div class="flex flex-row justify-between ml-12 px-4 mr-12 py-2 bg-white-one pt-2 mt-4 w-1/2" *ngIf="filterCheck === true">
  <p>{{filterName}} Filter Applied</p>

  <div *ngIf="startDate && endDate">
    <p>{{startDate}} - {{endDate}}</p>
  </div>

  <div *ngIf="positionTitle">
    <p>{{positionTitle}}</p>
  </div>
  <app-icon icon="close" class="cursor-pointer" (click)="clearFilterName()"></app-icon>

 
</div>
<!-- <div class="flex flex-row justify-end space-x-4 text-sm px-12 mb-3"> -->

<app-data-loader *ngIf="isLoading"></app-data-loader>
<div
  class="flex-row bg-white-one rounded-b-md ml-5 mr-5 shadow-sm"
  *ngIf="dataSourceTrainingPrograms"
>
  <!-- <div class="border-gray-one shadow-xs border-0.5 rounded mat-elevation-z8"> -->
  <div class="flex flex-col mt-3">
    <!-- search and buttons starts -->
    <div
      class="
        flex flex-row
        bg-white-one
        rounded-t-md
        py-4
        px-6
        space-x-2
        border-b-0.8 border-gray-one
        w-full
      "
    >
      <svg
        class="flex-none w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        ></path>
      </svg>
      <input
        class="text-sm flex-grow focus:outline-none"
        placeholder="Enter keywords to search"
        type="text"
        (keyup)="filterTrainingPrograms($event)"
        [(ngModel)]="filterText"
      />
      <app-icon icon="close" class="cursor-pointer" (click)="clearFilter()"></app-icon>

      <div class="flex flex-row space-x-4 text-sm"></div>
    </div>
  </div>
  <mat-table
    [dataSource]="dataSourceTrainingPrograms "
    matSort
    *ngIf="dataSourceTrainingPrograms"
  >
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="$event ? masterToggle() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()"
        >
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)"
        >
        </mat-checkbox>
      </td>
    </ng-container>
    <ng-container matColumnDef="positionTitle">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{("Position" | labelReplacement)| async}}s
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.position.positionTitle }}
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="trainingProgramTypeTitle">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        Program Type
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.trainingProgramType.trainingProgramTypeTitle }}
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="tpVersionNo">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        Version
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <div class="flex flex-col">
          <span>{{ row.version }}</span>
          <!-- <span class="mt-2">{{row.modifyDate | date:'medium' }}</span> -->
        </div>
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="startDate">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Year</mat-header-cell>
      <mat-cell *matCellDef="let row">
        <div class="flex flex-col mt-2">
          <ng-container *ngIf="row.trainingProgramType?.trainingProgramTypeTitle === 'Continuing Training Program'; else showDateRange">
            <span>{{row.year | date: 'yyyy'}}</span>
          </ng-container>
          <ng-template #showDateRange>
            <span>{{ row.startDate | date: 'yyyy' }} - {{ row.endDate | date: 'yyyy' }}</span>
          </ng-template>
        </div>
      </mat-cell>
      
    </ng-container>
    <ng-container matColumnDef="active">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        Status
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <div class="flex flex-col">
          <span>{{ row.active === true ? "Active" : "In Active" }}</span>
          <!-- <span class="mt-2">{{row.modifyDate | date:'medium' }}</span> -->
        </div>
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="id">
      <mat-header-cell *matHeaderCellDef> Action </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <div class="flex flex-row items-center text-gray-four btn-group">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <app-icon icon="more_vert"></app-icon>
          </button>
          <mat-menu #menu="matMenu">
            <!--     <label (click)="openEmpPage('view',row.id)" mat-menu-item translate>L.Open</label> -->
            <label
              (click)="openTrainingProgramPage('edit', row.id)"
              mat-menu-item
              translate
              [disabled]="row.active === false"
              >Edit</label
            >
            <label
              mat-menu-item
              translate
              (click)="openTrainingProgramPage('copy', row.id)"
              [disabled]="row.active === false"
              >Copy</label
            >
            <label
              mat-menu-item
              translate
              (click)="deleteTrainingProgram(unlinkModal, row)"
              [disabled]="isDeleteDisabled(row)"
              >Delete</label
            >
            <label
              mat-menu-item
              translate
              (click)="changeStatus(statusModal,row)"
              >{{ row.active === true ? "Make Inactive" : "Make Active" }}</label
            >
          </mat-menu>
        </div>
      </mat-cell>
    </ng-container>
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns" [ngClass]="{'inactive-row': !row.active}"></mat-row>

    <!-- Row shown when there is no matching data.-->
    <tr class="mat-row flex text-center" *matNoDataRow>
      <td class="mat-cell w-full m-2">No data matching the filter</td>
    </tr>
  </mat-table>

  <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons
                    aria-label="Select page of training programs">
                </mat-paginator>

  <!-- </div> -->
</div>

<ng-template #filterByPosition>
  <app-fly-panel-trainingprogram-position-filter
    (closed)="flyPanelService.close()"
    (check)="filterCheck=true"
    (filterPositions)="filterTrainingProgramByPositions($event)"
  >
  </app-fly-panel-trainingprogram-position-filter>
</ng-template>

<ng-template #filterByYear>
  <app-fly-panel-trainingprogram-year-filter
    (closed)="flyPanelService.close()"
    [trainingProgramList]="trainingProgramList"
    (check)="filterCheck=true"
    (filterYears)="filterTrainingProgramByYears($event)"
  >
  </app-fly-panel-trainingprogram-year-filter>
</ng-template>
<ng-template #unlinkModal>
  <app-qtd-dialogue header="Delete Training Program" [description]="deleteDescription" cancelText="No"
    confirmText="Yes" [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="Delete($event)">
  </app-qtd-dialogue>
</ng-template>
<ng-template #statusModal>
  <app-qtd-dialogue [header]="modalHeader" [description]="modalDescription" cancelText="No" confirmText="Yes"
      [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="MakeActive($event,!isActive)">
  </app-qtd-dialogue>
</ng-template>

<ng-template #ActiveInactiveList>
  <app-fly-panel-active-inactive-list [TrainingProgramName]="tpTypeName" [TrainingProgramStatus]="tpStatus">
  </app-fly-panel-active-inactive-list>
</ng-template>

