<ng-container>
  <div class="flex flex-col">
    <form [formGroup]="TQForm">
      <div
        class="
          border-gray-one border-0.5
          bg-white-one
          rounded
          mb-8
          pb-4
          pt-4
          pl-16
          pr-16
        "
      >
        <div class="flex flex-col mb-3">
          <ul>
            <li>
              <p class="text-base font-bold">
                {{("Task" | labelReplacement)| async}} Qualification Released Settings
              </p>
            </li>

            <li></li>

            <li class="pt-3">
              <mat-checkbox  formControlName="tqRequired" (change)="masterChange($event);">
                EMP will not be used for any {{("Task" | labelReplacement)| async}} Qualifications associated with this course</mat-checkbox
              >
            </li>
            <li class="pt-2">
              <div class="flex flex-col">
                <p class="text-base font-bold">
                  {{("Task" | labelReplacement)| async}} selected for {{("Task" | labelReplacement)| async}} Qualification
                </p>
                <table [dataSource]="dataSourceTask"
                  mat-table style="border: 1px solid #e5e7eb; width: 100%" cdkDropList [cdkDropListData]="dataSourceTask" (cdkDropListDropped)="dropTable($event)" [cdkDropListDisabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule || mode === 'view'" >

                  <ng-container matColumnDef="order">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                    <td mat-cell *matCellDef="let element">
                      <app-icon cdkDragHandle [ngClass]="{'disabled' : TQForm.get('tqRequired')?.value || isComingFromClassSchedule || mode === 'view'}" matTooltip="Drag to reorder the row" icon="drag_indicator" >
                      </app-icon>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="tasknumber">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      {{("Task" | labelReplacement)| async}} Number
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.number }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="desc">
                    <th mat-header-cell *matHeaderCellDef>Description</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.description }}
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumnsTask" ></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumnsTask" cdkDrag [cdkDragData]="row" [cdkDragDisabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule" ></tr>

                  <tr class="mat-row text-center" *matNoDataRow>
                    <td [attr.colspan]="displayedColumnsTask.length" class="mat-cell text-center mt-2" >
                      No questions present in {{("Task" | labelReplacement)| async}}
                    </td>
                  </tr>
                </table>
              </div>
            </li>

            <div class="text-base font-bold mt-2"><p>Release {{("Task" | labelReplacement)| async}}s for Qualification:</p></div>
            <li class="pt-2 pl-50">
              <div class="flex flex-col">
                <mat-checkbox [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule" formControlName="releaseAtOnce"
                  (change)="orderOfCompletion($event,'releaseAtOnce')"
                  >At the same time; order of completion does not matter.</mat-checkbox
                >
              </div>
            </li>
            <li class="pt-2  pl-50">
              <mat-checkbox [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule" formControlName="releaseOneAtTime"
              (change)="orderOfCompletion($event,'releaseOneAtTime')"
                >One at a time in the order specified in the table above.</mat-checkbox>
            </li>
            <li class="pl-50">
              <app-input-error *ngIf="!tqSelection.selected.includes('order') && !TQForm.get('tqRequired')?.value === true && !isComingFromClassSchedule" text="Please Select a Release Setting"></app-input-error>
            </li>
            <br />

            <li class="pt-2">
              <div class="flex flex-col">
                <p class="text-base font-bold">
                  {{("Task" | labelReplacement)| async}} not selected for {{("Task" | labelReplacement)| async}} Qualification
                </p>
                <table
                  [dataSource]="notSelectedTaskDataSource"
                  mat-table
                  style="border: 1px solid #e5e7eb; width: 100%"
                >
                  <ng-container matColumnDef="order">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                    <td mat-cell *matCellDef="let element">
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="tasknumber">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      {{("Task" | labelReplacement)| async}} Number
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.number }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="desc">
                    <th mat-header-cell *matHeaderCellDef>Description</th>

                    <td mat-cell *matCellDef="let element">
                      {{ element.description }}
                    </td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="displayedColumnsTask"
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumnsTask"
                  ></tr>

                  <tr class="mat-row text-center" *matNoDataRow>
                    <td
                      [attr.colspan]="displayedColumnsTask.length"
                      class="mat-cell text-center mt-2"
                    >
                      No Data found
                    </td>
                  </tr>
                </table>
              </div>
            </li>


            <li class="pt-2">
              <div class="flex flex-col">
                <div class="flex flex-row justify-between">
                  <span class="text-base font-bold">
                    {{("Task" | labelReplacement)| async}} Qualification Evaluators
                  </span>
                  <div>
                    <app-icon icon="link" class="text-qtd mr-1 cursor-pointer" [ngClass]="{'text-gray-400': mode === 'view'}"></app-icon>
                    <app-label
                      text="Link TQ Evaluators"
                      [customClasses]="mode !== 'view' ? 'text-qtd cursor-pointer' : 'text-gray-400'"
                      (click)="openFlyInPanel(linkEvaluators)"
                    ></app-label>
                  </div>
                </div>
                <span class="text-gray-400 mb-3"
                  >{{ dataSourceTaskEval.data.length }} TQ Evaluators
                  linked</span
                >
                <table
                  [dataSource]="dataSourceTaskEval"
                  mat-table
                  style="border: 1px solid #e5e7eb; width: 100%"
                >
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.person.firstName }}
                      {{ element.person.lastName }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="position">
                    <th mat-header-cell *matHeaderCellDef>{{("Position" | labelReplacement)| async}}</th>
                    <td mat-cell *matCellDef="let element">test</td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="displayedColumnsTaskEvaluators"
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="
                      let row;
                      columns: displayedColumnsTaskEvaluators
                    "
                  ></tr>

                  <tr class="mat-row text-center" *matNoDataRow>
                    <td
                      [attr.colspan]="displayedColumnsTaskEvaluators.length"
                      class="mat-cell text-center mt-2">
                      No evaluators present in list
                    </td>
                  </tr>
                </table>
              </div>
            </li>
            <div class="text-base font-bold mt-2"><p>Select Number of Evaluator Signatures Required for each {{("Task" | labelReplacement)| async}}:</p></div>
            <li class="pt-2 pl-50">
              <mat-checkbox
                formControlName="oneSignOffRequired"
                [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule"
                (change)="signOff($event,'oneSignOffRequired')"
                >One evaluator signature</mat-checkbox
              >
            </li>


            <!--multiple signoffs required part -->
            <li class="pt-2 pl-50" style="display: flex; align-items: center;">
              <mat-checkbox
                formControlName="multipleSignOffRequiredCheck"
                [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule"
                (change)="signOff($event, 'multipleSignOffRequiredCheck')"
              ></mat-checkbox>
            
              <div style="width: 20%; display: flex; align-items: center;" class="py-2">
                <mat-select
                  [disabled]="mode==='view' || !TQForm.get('multipleSignOffRequiredCheck').value || isComingFromClassSchedule"
                  formControlName="multipleSignOffRequired"
                  class="appearance-none rounded border w-full px-4 py-2.5 bg-white"
                >
                  <mat-option *ngFor="let p of dataSourceTaskEval.data; index as i" [value]="i + 1">
                    {{ i + 1 }}
                  </mat-option>
                </mat-select>
                <span style="margin-left: 5px;white-space: nowrap;">evaluator signatures</span>
              </div>
            </li>
            <li class="pt-2 multiple-sign">
            <app-input-error *ngIf="TQForm.get('multipleSignOffRequired')?.hasError('required')" text="Please Select Sign-Off's number"></app-input-error>
            <app-input-error *ngIf="!tqSelection.selected.includes('signOff') && !TQForm.get('tqRequired')?.value === true && !isComingFromClassSchedule" text="Please Select a Sign-Off setting"></app-input-error>
            </li>
            <div class="text-base font-bold mt-2"><p>Release {{("Task" | labelReplacement)| async}} Qualifications to Student & Evaluators</p></div>
            <li class="pt-2 pl-50">
              <mat-checkbox
                formControlName="releaseOnClassStart"
                [disabled]="TQForm.get('tqRequired')?.value"
                (change)="release($event,'releaseOnClassStart')">On class start date and time</mat-checkbox>
            </li>

            <li class="pt-2 pl-50">
              <mat-checkbox
                formControlName="releaseOnClassEnd"
                [disabled]="TQForm.get('tqRequired')?.value"
                (change)="release($event,'releaseOnClassEnd')"
                >On class end date and time</mat-checkbox
              >
            </li>

            <li class="pt-2 pl-50">
              <mat-checkbox
                formControlName="specificTime"
                [disabled]="TQForm.get('tqRequired')?.value"
                (change)="release($event,'specificTime')"
                >At specified time on class end date</mat-checkbox
              >
            </li>

            <li>
              <div style="width: 25%" class="py-2 pl-50">
                <mat-select
                  style="margin-right: 0px"
                  formControlName="setAvailabilityTimeTQ"
                  (selectionChange)="getTQAvailabilityTime($event)"
                  [disabled]="mode==='view' || TQForm.get('tqRequired')?.value || TQForm.get('specificTime')?.value == null || TQForm.get('specificTime')?.value == false"
                  class="
                    appearance-none
                    rounded
                    border
                    w-full
                    px-4
                    py-2.5
                    align-item-end
                    bg-white
                  "
                >
                  <mat-option
                    *ngFor="let item of testAvailabiilityTime"
                    [value]="item"
                    >{{ item.timeSpan }}</mat-option
                  >
                </mat-select>
              </div>
              <app-input-error *ngIf="TQForm.get('setAvailabilityTimeTQ')?.hasError('required')" class="pl-50" text="Please select availability Time"></app-input-error>
            </li>

            <li class="pl-50">
              <app-input-error *ngIf="!tqSelection.selected.includes('release') && !TQForm.get('tqRequired')?.value === true" text="Please Select a release Setting"></app-input-error>
            </li>

            <!-- <li class="pt-2">
                <div class="flex flex-col">
                  <mat-checkbox
                    >Set specific time to make Evaluation available
                    on class end date</mat-checkbox
                  >
                  <div style="width: 25%" class="py-2 ml-5">
                    <mat-select
                      style="margin-right: 0px"
                      class="
                        appearance-none
                        rounded
                        border
                        w-full
                        px-4
                        py-2.5
                        align-item-end
                        bg-white
                      "
                    >
                      <mat-option
                        *ngFor="let item of testAvailabiilityTime"
                        >{{ item.timeSpan }}</mat-option
                      >
                    </mat-select>
                  </div>
                </div>
              </li> -->
             
            <li class="pt-2">
              <div class="flex flex-col py-2">
                <mat-checkbox formControlName="suggestions" class="mb-1" [disabled]="TQForm.get('tqRequired')?.value">Show {{("Task" | labelReplacement)| async}} Specific Suggestions upon launch of {{("Task" | labelReplacement)| async}}
                  Qualification</mat-checkbox>
                <mat-checkbox formControlName="questions" [disabled]="TQForm.get('tqRequired')?.value">Show {{("Task" | labelReplacement)| async}} Questions</mat-checkbox>
              </div>
              <div class="flex flex-col">
                <span>{{("Task" | labelReplacement)| async}} Qualification Due Date</span>
                <span class="text-gray-400"
                  >The number of {{getSelectedDueDateType() | lowercase}} following the class end date/time
                  students and Evaluators have to complete the {{("Task" | labelReplacement)| async}}
                  Qualifications in EMP. After this due date, the {{("Task" | labelReplacement)| async}}
                  Qualifications will be removed from EMP and Students will not
                  be awarded a completion entry.</span
                >
                <div class="border py-2 flex mt-3" style="width: 20%; align-items: center">
                  <app-textbox [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule" formControlName="tqDueDate" (keypress)="keyPressNumbers($event)" [maxLength]="3" class="modifiedTextbox"></app-textbox>
                  <mat-select [disabled]="TQForm.get('tqRequired')?.value || isComingFromClassSchedule" formControlName="empSettingsReleaseType">
                    <mat-option *ngFor="let type of empSettingsReleaseTypes" [value]="type.typeId">{{type.typeName}}</mat-option>
                  </mat-select>
                </div>
                <app-input-error *ngIf="TQForm.get('tqDueDate')?.hasError('required') || TQForm.get('empSettingsReleaseType')?.hasError('required')" text="Please Enter a Due Date"></app-input-error>
              </div>
            </li>
          </ul>
        </div>
        <!-- <div class="flex flex-row justify-end">
                <app-button
                  type="submit"
                  color="secondary"
                  text="Save"
                  size="sm"
                  [disabled]="true"
                >
                </app-button>
              </div> -->
      </div>
    </form>
  </div>
</ng-container>

<ng-template #linkEvaluators>
  <app-flypanel-link-task-qualification-evaluators
    [isComingFromClassSchedule] = "isComingFromClassSchedule"
    (tqSelected)="tqSelected($event)"
    (refreshtq)="refreshTQ($event)"
    [IlaId]="ilaId"
    [classScheduleId]="classScheduleId"
    [qualData]="qualInfo"
  >
  </app-flypanel-link-task-qualification-evaluators>
</ng-template>
