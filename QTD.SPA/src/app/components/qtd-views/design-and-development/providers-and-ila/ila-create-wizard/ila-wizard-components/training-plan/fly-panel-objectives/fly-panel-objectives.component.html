<!-- Objectives starts here -->
<ng-container *ngIf="!isCustomEO">
  <ng-container *ngIf="!addTask">
    <div class="flex flex-row justify-between items-center px-12 mt-5">
      <h1 class="text-xl font-medium text-gray-900">Link Objectives to {{("ILA" | labelReplacement)| async}}</h1>
      <app-button type="button" ButtonType="icon" icon="close" (clicked)="closed.emit($event)"></app-button>
    </div>


    <mat-tab-group (selectedTabChange)="onChange($event)" [dynamicHeight]="true">

      <mat-tab label="{{('Task' | labelReplacement)| async}}s">
        <!--Heading starts-->
        <div class="flex flex-row px-12 justify-between">

          <div class="flex flex-row border-b self-center w-1/2  mt-4">
            <div class="mt-2 text-xs text-gray-400 mr-3">
              <app-icon icon="search"></app-icon>
            </div>
            <div class="text-xs w-full">
              <input (input)="filter(true);" [(ngModel)]="filterTaskString"
                placeholder="Search by keyword/phrase" class="w-8/12 py-2" />
            </div>
          </div>

          <div class="flex flex-col">
            <app-button variant="text" style="margin-top: 30%;" icon="add" iconPosition="left" text="Add new {{('Task' | labelReplacement)| async}}"
    (click)="addTaskFlyin = true; addTask = true;EOCheckListSelection.clear();taskCheckListSelection.clear()"></app-button>

          </div>
        </div>
        <!--Heading ends-->
        <!-- <div class="ml-12">

        </div> -->

        <div class="flex flex-row px-12 justify-between mt-4">
          <div class="flex flex-col">
            <mat-checkbox [(ngModel)]="includeEos">Include EOs linked to {{("Task" | labelReplacement)| async}}s</mat-checkbox>
            <mat-checkbox [(ngModel)]="includeProcedures">Include {{("Procedure" | labelReplacement)| async}}s linked to {{("Task" | labelReplacement)| async}}s</mat-checkbox>
            <mat-checkbox [checked]="isIncludeMetaTask" (change)="onIncludeMetaTaskChange($event)">Include all {{("Task" | labelReplacement)| async}}s linked to Meta</mat-checkbox>
            <!-- <mat-checkbox>Include Tools linked to Tasks</mat-checkbox> -->
          </div>
        </div>
        <div class="flex flex-col flex-wrap bg-gray-one mb-3 mt-3  px-3 py-3 rounded" *ngIf="taskCheckListSelection.selected.length > 0">
          <div class="flex flex-row w-full justify-between mb-3">
            <p class="text-xs text-gray-four pt-2">{{taskCheckListSelection.selected.length}} {{("Task" | labelReplacement)| async}}s selected</p>
            <app-button (clicked)="linkTaskObjectives()" [disabled]="showLinkTaskLoader" [spinner]="showLinkTaskLoader" class="mb-2" type="button"
              color="secondary" size="sm" text="Link {{('Task' | labelReplacement)| async}}">
            </app-button>
          </div>
          <hr>
          <p class="text-xs text-gray-four mt-3">Selecting a Duty Area or Sub-Duty Areas will select all {{("Task" | labelReplacement)| async}}s linked
            to
            the given category</p>
        </div>
        <div class="flex flex-row px-12 mt-4 text-xs text-gray-500">
          <p class="mt-3">Showing: Active {{("Task" | labelReplacement)| async}}s <app-icon icon="expand_more"></app-icon>
          </p>
          <!-- <app-button class="mt-1" ButtonType="icon" [icon]="active_tasks ? 'expand_more' : 'expand_less'"></app-button> -->
        </div>
        <!-- *ngIf="active_tasks" -->
        <p class="text-gray-500 font-medium text-sm px-12">Duty Areas</p>
        <app-spinner [hidden]="dataSource.data.length > 0"></app-spinner>
        <ng-container *ngIf="dataSource.data.length > 0">
          <div class="flex flex-col px-12">
            <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="qtd-tree">
              <!-- This is the tree node template for leaf nodes -->
              <!-- There is inline padding applied to this node using styles.
                        This padding value depends on the mat-icon-button width. -->
              <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding  [hidden]="!node.active">
                <mat-checkbox [checked]="node.selected" (change)="onTaskChange($event,node)"
                  *ngIf="node.checkbox === undefined || !node.checkbox">
                  {{node.description}}</mat-checkbox>
                <ng-container *ngIf="node.checkbox">
                  <div class="flex">
                    <app-icon class="mr-2" style="color: rgb(92, 155, 49);" icon="link"></app-icon>&nbsp;
                  <span style="color: rgb(92, 155, 49);">{{node.description}}</span>
                  </div>
                </ng-container>
                <span *ngIf="node.isMeta" class="ml-1 qtd-meta-box p-1 font-bold">{{'meta'|titlecase}}</span>
              </mat-tree-node>
              <!-- This is the tree node template for expandable nodes -->
              <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChildTask">
                <div class="mat-tree-node">
                  <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.description">
                    <app-icon [icon]="treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'">
                    </app-icon>
                  </button>
                  <mat-checkbox [checked]="node.selected" [indeterminate]="node.indeterminate && !node.selected"
                  (change)="itemToggle($event.checked,node)"></mat-checkbox>
                  <span class="ml-1 pb-1">{{node.description}}</span>
                </div>
                <!-- There is inline padding applied to this div using styles.
                              This padding value depends on the mat-icon-button width.  -->
                <div [class.qtd-tree-invisible]="!treeControl.isExpanded(node)" role="group">
                  <ng-container matTreeNodeOutlet></ng-container>
                </div>
              </mat-nested-tree-node>
            </mat-tree>

          </div>
        </ng-container>
      </mat-tab>


      <mat-tab label="{{('Enabling Objective' | labelReplacement)| async}}s">
        <div class="flex flex-col px-12 mt-2">
          <div class="flex flex-row justify-between mt-4 mb-4">
            <div class="flex flex-row border-b w-8/12">
              <div class="mt-2 text-xs text-gray-400 mr-3">
                <app-icon icon="search"></app-icon>
              </div>
              <div class="text-xs w-8/12">
                <input [(ngModel)]="filterEOString" (input)="filterDataNew(true)" placeholder="Search by keyword/phrase" class="w-8/12 py-2" />
              </div>
            </div>

            <div class="flex flex-col">
              <app-button variant="text" icon="add" iconPosition="left" text="Add {{('Enabling Objective' | labelReplacement)| async}}s"
              (clicked)="addEO = true;addTask = true"></app-button>
          </div>
            <!-- <app-button type="button" color="secondary" size="sm" leftIcon="filter_alt" rightIcon="expand_more"
              text="Filter by" [matMenuTriggerFor]="filterMenuSecond">
            </app-button>
            <mat-menu #filterMenuSecond="matMenu">
              <label mat-menu-item>Category</label>
              <label mat-menu-item>Sub-Category</label>
              <label mat-menu-item>Topic</label>
            </mat-menu> -->
          </div>
          <!--Filter By ends-->
        </div>
        <div class="flex flex-row px-12 justify-between my-4">
          <div class="flex flex-col">
            <mat-checkbox [checked]="isIncludeMetaEO" (change)="onIncludeMetaEOChange($event)">Include all {{("Enabling Objective" | labelReplacement)| async}}s linked to Meta</mat-checkbox>
          </div>
        </div>
        <div class="flex flex-col flex-wrap bg-gray-one mb-3 mt-3  px-3 py-3 rounded" *ngIf="EOCheckListSelection.selected.length > 0">
          <div class="flex flex-row w-full justify-between mb-3">
            <p class="text-xs text-gray-four pt-2">{{EOCheckListSelection.selected.length}} {{("Enabling Objective" | labelReplacement)| async}}s
              Selected</p>
            <app-button [disabled]="showEOLinkLoader || EOCheckListSelection.selected.length < 1" [spinner]="showEOLinkLoader"
            (clicked)="linkEnablingObjectives()" class="mb-2" type="button"
              color="secondary" size="sm" text="Link Objectives">
            </app-button>
          </div>
          <hr>
          <p class="text-xs text-gray-four mt-3">Selecting a Duty Area or Sub-Duty Areas will select all {{("Task" | labelReplacement)| async}}s linked
            to
            the given category</p>
        </div>
        <app-spinner [hidden]="enablingObjectiveDataSource.data.length > 0"></app-spinner>
        <ng-container *ngIf="enablingObjectiveDataSource.data.length > 0">
          <div class="flex flex-col px-12">
            <mat-tree [dataSource]="enablingObjectiveDataSource" [treeControl]="EOTreeControl" class="qtd-tree">
              <!-- This is the tree node template for leaf nodes -->
              <!-- There is inline padding applied to this node using styles.
                        This padding value depends on the mat-icon-button width. -->
              <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
                <mat-checkbox [checked]="node.selected" (change)="onEOChange($event,node)" *ngIf="node.checkbox !== undefined && node.checkbox">
                  {{node.description}} 
                  <span *ngIf="node.isMeta" class="ml-1 qtd-meta-box p-1 font-bold">{{'meta'|titlecase}}</span>
                  <span *ngIf="node.IsEO && !node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'EO'|uppercase}}</span>
                  <span *ngIf="node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'SQ'|uppercase}}</span>
                </mat-checkbox>
                <ng-container *ngIf="node.checkbox !== undefined && !node.checkbox">
                  <div class="flex">
                    <app-icon class="mr-2" style="color: rgb(92, 155, 49);" icon="link"></app-icon>&nbsp;
                    <span style="color: rgb(92, 155, 49);">{{node.description}} 
                      <span *ngIf="node.isMeta" class="ml-1 qtd-meta-box p-1 font-bold">{{'meta'|titlecase}}</span>
                      <span *ngIf="node.IsEO && !node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'EO'|uppercase}}</span>
                      <span *ngIf="node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'SQ'|uppercase}}</span>
                    </span>
                  </div>
                </ng-container>
                <span *ngIf="node.checkbox === undefined">{{node.description}}</span>
                <span *ngIf="node.checkbox === undefined && node.isMeta" class="ml-1 qtd-meta-box p-1 font-bold">{{'meta'|titlecase}}</span>
                <span *ngIf="node.checkbox === undefined && node.IsEO && !node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'EO'|uppercase}}</span>
                <span *ngIf="node.checkbox === undefined && node.isSkillQualification" class="ml-1 qtd-meta-box p-1 font-bold">{{'SQ'|uppercase}}</span>
              </mat-tree-node>
              <!-- This is the tree node template for expandable nodes -->
              <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                <div class="mat-tree-node">
                  <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.description">
                    <app-icon [icon]="EOTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'">
                    </app-icon>
                  </button>
                  <mat-checkbox [checked]="node.selected" [indeterminate]="node.indeterminate && !node.selected"
                  (change)="itemToggle2($event.checked,node)"></mat-checkbox>
                  <span class="ml-1 pb-1">{{node.description}}</span>
                </div>
                <!-- There is inline padding applied to this div using styles.
                              This padding value depends on the mat-icon-button width.  -->
                <div [class.qtd-tree-invisible]="!EOTreeControl.isExpanded(node)" role="group">
                  <ng-container matTreeNodeOutlet></ng-container>
                </div>
              </mat-nested-tree-node>
            </mat-tree>

          </div>
        </ng-container>

      </mat-tab>
    </mat-tab-group>

  </ng-container>
  <ng-container *ngIf="addTaskFlyin === true">
    <div class="px-12 py-12">
      <app-flypanel-add-task (closed)="addTask=false;isCustomEO=false;addTaskFlyin=false;readyTasksTreeData()">
      </app-flypanel-add-task>
    </div>
  </ng-container >

  <ng-container *ngIf="addEO">
    <div class="px-12 py-12">
      <app-flypanel-add-eo (closed)="addTask=false;isCustomEO=false;addEO=false;readyEnablingObjectiveTreeData()">
      </app-flypanel-add-eo>
    </div>

  </ng-container>
  <!-- <app-data-loader></app-data-loader> -->


  <!-- List section starts here -->
  <!-- *ngIf="active_tasks" -->
  <!-- <ng-container>
        <div class="flex flex-col px-12">
            <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="qtd-tree"> -->
  <!-- This is the tree node template for leaf nodes -->
  <!-- There is inline padding applied to this node using styles.
              This padding value depends on the mat-icon-button width. -->
  <!-- <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
                    <mat-checkbox *ngIf="node.checkbox === undefined || !node.checkbox">{{node.description}}</mat-checkbox>
                    <span *ngIf="node.checkbox">{{node.description}}</span>
                </mat-tree-node> -->
  <!-- This is the tree node template for expandable nodes -->
  <!-- <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                    <div class="mat-tree-node">
                        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.description">
                            <app-icon [icon]="treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'">
                            </app-icon>
                        </button>

                        {{node.description}}
                    </div> -->
  <!-- There is inline padding applied to this div using styles.
                    This padding value depends on the mat-icon-button width.  -->
  <!-- <div [class.qtd-tree-invisible]="!treeControl.isExpanded(node)" role="group">
                        <ng-container matTreeNodeOutlet></ng-container>
                    </div>
                </mat-nested-tree-node>
            </mat-tree>

        </div>
    </ng-container> -->
</ng-container>
<!-- Objectives ends here -->

<!-- Custom Objectives Container -->
<ng-container *ngIf="isCustomEO">
  <div class="flex flex-row justify-between items-center px-12 mt-5">
    <h1 class="text-xl font-medium text-gray-900">Custom Objectives</h1>

    <app-button type="button" ButtonType="icon" icon="close" (clicked)="closed.emit($event)"></app-button>
  </div>

  <div class="flex flex-row justify-between items-center px-12 mt-2">
    <p class="text-sm font-small text-gray-400">Use the free form fields below to add specific Objectives for the
      selected {{("ILA" | labelReplacement)| async}}. The Objectives added below will
      only be available for this {{("ILA" | labelReplacement)| async}}. To add the objectives to your EO hierarchy, select the Add to E0 List
      option.
    </p>
  </div>

  <!--  <div class="flex flex-row justify-between items-center px-12 mt-5">
        <p class="text-sm font-small text-gray-400">3 custom objectives added</p>
        <app-button color="secondary" type="button" text="Publish" size="sm"></app-button>
    </div>
 -->
  <div class="px-12 mt-5" *ngIf="createCustomEOForm">
  <div *ngIf="spinner" class="spinner-border">
    <app-spinner  class="spinner internal-spinner"></app-spinner>
  </div>
    <form *ngIf="!spinner" [formGroup]="createCustomEOForm" (ngSubmit)="createEnablingObjective()">
      <ul class="flex flex-col">
        <!--Category Starts-->
        <mat-label class="font-sm">Category</mat-label>
        <mat-form-field appearance="outline" class="text-sm dropdown w-full">
          <mat-select placeholder="Select a Category" formControlName="eo_catId" (selectionChange)="getEO_SubCategories($event.value)">
            <mat-option *ngFor="let cat of eo_catogories" [value]="cat.id">
              {{cat.number}} - {{cat.title}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <!--Category Ends-->

        <!--Sub Category Starts-->
        <mat-label class="font-sm mt-3">Sub-Category</mat-label>
        <mat-form-field appearance="outline" class="text-sm dropdown w-full">
          <mat-select placeholder="Select a Sub-Category" formControlName="eo_subCatId" (selectionChange)="getEO_Topics($event.value)">
            <mat-option *ngFor="let subCat of eo_subCategories" [value]="subCat.id">
              {{subCat.number}} - {{subCat.title}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <app-input-error *ngIf="createCustomEOForm.get('eo_subCatId')?.invalid" text="SubCategory is required">
        </app-input-error>
        <!--Sub Category Ends-->

        <!--Topics Starts-->
        <mat-label class="font-sm mt-3">Topics</mat-label>
        <mat-form-field appearance="outline" class="text-sm dropdown w-full">
          <mat-select placeholder="Select a Topic" formControlName="eo_topicId">
            <mat-option *ngFor="let eo_topic of eo_topics" [value]="eo_topic.id" ngDefaultControl
              formControlName="eo_topicId">
              {{eo_topic.number}} - {{eo_topic.title}}

            </mat-option>
          </mat-select>
        </mat-form-field>
        <app-input-error *ngIf="createCustomEOForm.get('eo_topicId')?.invalid" text="Topic is required">
        </app-input-error>
        <!--Topics Ends-->

        <!--Custom Objective Starts-->
        <app-textbox placeholder="Enter custom objective here..." formControlName="description">
        </app-textbox>
        <app-input-error *ngIf="createCustomEOForm.get('description')?.invalid"
          text="Custom {{('Enabling Objective' | labelReplacement)| async}} description is required">
        </app-input-error>
        <app-input-error *ngIf="createCustomEOForm.get('description')?.hasError('maxLength')"
          text="Custom {{('Enabling Objective' | labelReplacement)| async}} description must be less than 400 charachters">
        </app-input-error>
        <!--Custom Objective Ends-->

        <mat-checkbox (change)="changeValidations($event)" formControlName="isAddToEO" class="mt-3">Add to EO list</mat-checkbox>
      </ul>

      <!--Publish and Add New Button Starts-->
      <div class="mt-8 flex flex-row justify-end">
        <app-button *ngIf="mode === 'add'" type="submit" size="sm" color="primary" text="Save" [spinner]="processing"
          [disabled]="createCustomEOForm.invalid || processing"></app-button>
         <app-button  *ngIf="mode === 'edit'" class="ml-2" type="button" size="sm" color="primary" text="Update"
          [disabled]="createCustomEOForm.invalid" (clicked)="updateEnablingObjective()"></app-button> 
      </div>
      <!--Publish and Add New Button Ends-->
    </form>
  </div>



</ng-container>
<!-- Custom Objectives Container -->
