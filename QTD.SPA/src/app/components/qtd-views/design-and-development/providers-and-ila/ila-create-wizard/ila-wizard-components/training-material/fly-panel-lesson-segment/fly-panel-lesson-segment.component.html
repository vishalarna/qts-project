<ng-container>
  <div [hidden]="objpanel">
    <div class="flex flex-row justify-between items-center px-12 mt-5">
      <p class="text-xl font-bold text-gray-900">Add New {{("ILA" | labelReplacement)| async}} Segment</p>
      <app-button type="button" ButtonType="icon" icon="close" (clicked)="flyPanelSrvc.close()"></app-button>
    </div>
    <div>
      <div *ngFor="let s of segments; let i=index">
        <h3 class="px-4">{{s}}</h3>
        <div class="flex flex-col px-4 pb-12 ">
          <div class="py-6 px-6 space-y-6 border-gray-one shadow-xs border-0.5 bg-white-one rounded mb-8">
            <ng-container [formGroup]="group">
              <div class="flex flex-row ">
                <div class="flex flex-col mr-4">
                  <span class="mt-3 font-medium text-sm">Segement Title</span>
                  <app-textbox formControlName="title{{i}}" placeholder="Segment Title">
                  </app-textbox>
                  <app-input-error text="Segment Title is Required" *ngIf="group.get('title' + i)?.errors?.required">
                  </app-input-error>
                </div>
                <div class="flex flex-col">
                  <span class="mt-3 font-medium text-sm">Segment Duration</span>
                  <div class="flex flex-col">
                    <app-textbox (keypress)="durationChanged($event)" formControlName="duration{{i}}"
                      placeholder="Enter Duration"></app-textbox>
                    <app-input-error *ngIf="group.get('duration' + i)?.errors?.required" text="Duration is Required">
                    </app-input-error>
                    <mat-form-field appearance="outline" style="vertical-align: sub;" class="mt-1">
                      <mat-select value="min">
                        <mat-option value="min">
                          (min)
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
              </div>
              <div class="flex flex-col">
                <span *ngIf="isNercProvider" class="mt-3 font-medium text-sm">NERC Only - Segment Includes the
                  following</span>
                <ul *ngIf="isNercProvider" class="mt-4">
                  <li>
                  <mat-checkbox formControlName="isPartialCredit{{i}}">Is Partial Credit</mat-checkbox>
                  </li>
                  <li>
                    <mat-checkbox formControlName="isStandard{{i}}">Standard related hours</mat-checkbox>
                  </li>
                  <li>
                    <mat-checkbox formControlName="isOperationTopic{{i}}">Operating Topics/CEHs</mat-checkbox>
                  </li>
                  <li>
                    <mat-checkbox formControlName="isSimulation{{i}}">Simulation Hours</mat-checkbox>
                  </li>
                </ul>
                <p class="flex-grow font-medium mt-3">Segment Description
                </p>
                <ckeditor formControlName="description{{i}}" [editor]="Editor" (ready)="onReady($event)">
                </ckeditor>
                <app-input-error text="Segment Description Is Required"
                  *ngIf="group.get('description' + i)?.errors?.required"></app-input-error>
              </div>
              <div class="flex flex-row">
                <app-button variant="text" text="Link Segment Objectives" iconPosition="left" icon="add"
                  (clicked)="changeIndex(i)"></app-button>
              </div>
              <div class="flex flex-row justify-end">
                <app-button color="secondary" size="sm" text="Unlink" *ngIf="false">
                </app-button>
              </div>
              <app-data-loader *ngIf="false"></app-data-loader>
              <ng-container *ngIf="length[i] > 0">
                <mat-table [dataSource]="length[i] > 0 ? selectedId[i]:[]" matSort cdkDropList class="table-bordered"
                  [cdkDropListData]="selectedId[i]" (cdkDropListDropped)="dropTable($event,i)">
                  <ng-container matColumnDef="drag">
                    <mat-header-cell *matHeaderCellDef>
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                      <app-icon cdkDragHandle matTooltip="Drag to reorder the row"
                        style="pointer-events:all;color: darkgrey!important;cursor:move" icon="drag_indicator">
                      </app-icon>
                    </mat-cell>
                  </ng-container>
                  <!-- <ng-container matColumnDef="id">
                  <mat-header-cell *matHeaderCellDef>
                    <mat-checkbox>
                    </mat-checkbox>
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <mat-checkbox (change)="stausChanged(row,i,$event)">
                    </mat-checkbox>
                  </mat-cell>
                </ng-container> -->
                  <ng-container matColumnDef="number">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> #
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row"> {{row.number}}
                    </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="type">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Type
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row"> {{row.type}} </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="description">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Description
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row" [matTooltip]="row.description"
                      [ngStyle]="{'color':row.type=='Custom'?'orange':''}">
                      {{row.description}} </mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="id">
                    <mat-header-cell *matHeaderCellDef>
                      <span *ngIf="saved[i]">Unlink</span>
                      <span *ngIf="!saved[i]">Remove</span>
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                      <app-icon (click)="unlinkEO(row,i)" style="color: grey;cursor: pointer;" icon="link_off">
                      </app-icon>
                    </mat-cell>
                  </ng-container>



                  <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: displayColumns;" cdkDrag (cdkDragStarted)="dragStarted($event)"
                    [cdkDragData]="row"></mat-row>

                  <!-- Row shown when there is no matching data.-->
                  <tr class="mat-row flex text-center " *matNoDataRow>
                    <td class="mat-cell w-full m-2">No data to display</td>
                  </tr>

                </mat-table>
                <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons
                  aria-label="Select page of periodic elements">
                </mat-paginator>
              </ng-container>
            </ng-container>
            <div class="flex flex-row justify-end">
              <app-button *ngIf="!saved[i]" type="button" size="sm" color="secondary" text="Cancel" class="mr-5"
                (clicked)="cancelClicked(i)">
              </app-button>
              <app-button *ngIf="!saved[i]" [spinner]="isSaving[i]" (clicked)="saveSegmentData(i)" type="submit"
                size="sm" text="Save" [disabled]="group.get('description' + i)?.errors?.required
            || group.get('title' + i)?.errors?.required || group.get('duration' + i)?.errors?.required">
              </app-button>

              <app-button
                *ngIf="showLinked[i]"
                (clicked)="createOnlyLinks(i)"
                text="Save Link Changes">
                </app-button>

            </div>

          </div>
        </div>
      </div>
    </div>


    <!-- dynamic segment -->

    <ng-container *ngIf="addSegment">
      <p class="flex-grow font-medium text-gray-400">Segment</p>
      <div class="py-6 px-6 space-y-6 shadow-xs bg-white-one rounded mb-8">
        <ng-container>
          <div class="flex flex-row justify-between">
            <div class="flex flex-col w-15/24">
              <span class="mt-3 font-medium text-sm">Segment Title</span>
              <input type="text" class="text-base border h-5 py-6 mt-1 rounded" />
            </div>
            <div class="flex flex-col">
              <span class="mt-3 font-medium text-sm">Segment Duration</span>
              <span>
                <!--   <input type="number" class="text-base border h-5 py-6 mt-2 rounded " /> -->
                <mat-form-field appearance="outline" style="vertical-align: sub;">
                  <mat-select value="min">
                    <mat-option value="min">
                      (min)
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </span>
            </div>
          </div>
          <div class="flex flex-col">
            <span *ngIf="isNercProvider" class="mt-3 font-medium text-sm">NERC Only - Segment Includes the following</span>
            <ul *ngIf="isNercProvider" class="mt-4">
              <li>
                <mat-checkbox>Standard related hours</mat-checkbox>
              </li>
              <li>
                <mat-checkbox>Operating Topics/CEHs</mat-checkbox>
              </li>
              <li>
                <mat-checkbox>Simulation Hours</mat-checkbox>
              </li>
            </ul>
          </div>
          <div class="flex flex-row justify-between">
            <!-- <h2 class="flex-grow font-normal">Objectives
                        </h2> -->
            <app-button variant="text" text="Add Segment Objective" iconPosition="left" icon="add"
              (clicked)="addSegment=false"></app-button>
          </div>
          <ng-container *ngIf="DataSource">
            <mat-table [dataSource]="DataSource" matSort class="border rounded-sm">
              <ng-container matColumnDef="number">
                <mat-header-cell *matHeaderCellDef mat-sort-header> #
                </mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.number}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="type">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Type
                </mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.type}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="description">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Description
                </mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.description}} </mat-cell>
              </ng-container>


              <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayColumns;"></mat-row>

              <!-- Row shown when there is no matching data.-->
              <!--    <tr class="mat-row flex text-center " *matNoDataRow>
                                <td class="mat-cell w-full m-2">No data to display</td>
                            </tr> -->

            </mat-table>
            <!--    <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons
                            aria-label="Select page of periodic elements">
                        </mat-paginator> -->
          </ng-container>

          <p class="flex-grow font-normal mt-8">Add Segment Content</p>
          <ckeditor [config]="configCKEditor" [editor]="Editor" (ready)="onReady($event)"></ckeditor>

          <div class="flex flex-row justify-end">
            <app-button type="button" size="sm" color="secondary" text="Cancel" class="mr-5"
              (clicked)="addSegment=false">
            </app-button>
            <app-button type="button" size="sm" text="Save"></app-button>

          </div>
        </ng-container>

      </div>
    </ng-container>

    <app-button [disabled]="!allSegmentsSaved()" *ngIf="!addSegment" variant="text" text="Add next segment"
      iconPosition="left" icon="add" (clicked)="readyFrom()">
    </app-button>
  </div>
</ng-container>

<!-- <ng-container #objectives *ngIf="objpanel">
  <app-fly-panel-objectives [isCustomEO]="isCustomEO" (closed)="objpanel=false"></app-fly-panel-objectives>
</ng-container> -->
<ng-container *ngIf="objpanel">

  <app-fly-panel-link-scenario-objective 
  [selectedIds]="selectedId" 
  (sendId)="receiveId($event)"
    [isCustomEO]="isCustomEO" 
    [flyPanelCheck]="flyPanelCheck" 
    (closed)="objpanel=false"
     [linkedTaskIds]="linkedTaskIds"
    [linkedEOIds]="linkedEOIds"
    [linkedCOIds]="linkedCOIds"
    [segmentTitle]="segmentTitle">
  </app-fly-panel-link-scenario-objective>
</ng-container>
