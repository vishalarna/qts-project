<div class="flex flex-row flex-wrap mt-3 justify-between">
  <div class="flex flex-col">
      <p class="font-bold text-lg">Linkages:  {{("Employee" | labelReplacement)| async}}(s)</p>
      <p class="text-xs text-gray-four">{{employees?.length}}  {{("Employee" | labelReplacement)| async}}(s) linked to selected {{("Position" | labelReplacement)| async}}</p>
  </div>
  <app-button  [disabled]="!isActive" variant="text" icon="link" iconPosition="left" style="cursor: pointer!important" text="Link  {{('Employee' | labelReplacement)| async}}(s)"
      (clicked)="openFlypanel(positionsskasLink)">
  </app-button>
</div>
<app-data-loader *ngIf="!DataSource"></app-data-loader>
<div class="shadow-md" *ngIf="DataSource">
<div class="flex flex-row flex-wrap bg-gray-one px-2 py-2 justify-between mb-3 mt-3  px-3 py-3 rounded"
    *ngIf="unlinkIds.length > 0">
    <p class="text-xs text-gray-four pt-2">{{unlinkIds.length}}  {{("Employee" | labelReplacement)| async}} selected</p>
    <app-button [disabled]="!isActive" icon="link_off" iconPosition="left" size="sm" color="secondary" text="Unlink  {{('Employee' | labelReplacement)| async}}"
        (clicked)="unlinkItemsModal(unlinkModal)">
    </app-button>
</div>
<mat-table [dataSource]="DataSource" matSort class="table-bordered" (matSortChange)="sortData()">
    <ng-container matColumnDef="id">
        <mat-header-cell *matHeaderCellDef>
            <mat-checkbox [disabled]="!isActive" (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox>
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <mat-checkbox [disabled]="!isActive" (click)="$event.stopPropagation()" (change)="$event ? selectrow(row) : null"
                [checked]="selection.isSelected(row)">
            </mat-checkbox>
        </mat-cell>
    </ng-container>
    <ng-container matColumnDef="image">
        <mat-header-cell *matHeaderCellDef> </mat-header-cell>
        <mat-cell *matCellDef="let row"> <img style="border-radius: 50%;width: 50px;height: 50px;" class="img-fluid mr-2 mt-2 ml-2 mb-2"
            [src]="row.image"
            onerror="this.src='assets/img/ImageNotFound.jpg'"> </mat-cell>
    </ng-container>
    <ng-container matColumnDef="username">
        <mat-header-cell *matHeaderCellDef mat-sort-header>  {{("Employee" | labelReplacement)| async}} Name
        </mat-header-cell>
        <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
            <div class="flex flex-col">
                <span class="font-bold">{{row.fullName}}</span>
                <span class="text-gray-400">{{row.userName}}</span>
            </div>
              </mat-cell>
    </ng-container>
    <ng-container matColumnDef="positionTitle">
        <mat-header-cell *matHeaderCellDef mat-sort-header> {{("Position" | labelReplacement)| async}} Title
        </mat-header-cell>
        <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
            {{row.positionTitle}} </mat-cell>
    </ng-container>
    <ng-container matColumnDef="startDate">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Start Date
      </mat-header-cell>
      <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
          {{row.startDate === null || row.startDate === undefined ? "N/A":datePipe.transform(row.startDate,'MM-dd-yyyy')}} </mat-cell>
  </ng-container>
  <ng-container matColumnDef="trainee">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Trainee Status
    </mat-header-cell>
    <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
        {{row.trainee}} </mat-cell>
</ng-container>
<ng-container matColumnDef="qualificationDate">
  <mat-header-cell *matHeaderCellDef mat-sort-header> {{("Position" | labelReplacement)| async}} Qualification Date
  </mat-header-cell>
  <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
      {{row.qualificationDate === null || row.qualificationDate === undefined ? 'N/A':datePipe.transform(row.qualificationDate,'MM-dd-yyyy')}} </mat-cell>
</ng-container>

    <!-- <ng-container matColumnDef="linkageCount">
        <mat-header-cell *matHeaderCellDef mat-sort-header> # of linkages
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="justify-between" [class.inActiveItem]="!row.active">
            <app-button variant="text" [text]="row.linkCount" (clicked)="title=row.description;empId=row.id;openFlypanel(linkedFlyPanel)">
          </app-button>
            <app-button [disabled]="!isActive" ButtonType="icon" icon="link_off" style="color:lightgray"
                (clicked)="unlinkItemsModal(unlinkModal,row.id)">
            </app-button>
        </mat-cell>
    </ng-container> -->


    <ng-container>
        <mat-header-cell *matHeaderCellDef mat-sort-header>
        </mat-header-cell>
        <mat-cell *matCellDef="let row" matTooltip="Unlink (('Employee' | labelReplacement)| async)s">
            <app-icon icon="link_off"></app-icon>
        </mat-cell>
    </ng-container>
    <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayColumns;"></mat-row>

    <!-- Row shown when there is no matching data.-->
    <tr class="mat-row flex text-center " *matNoDataRow>
        <td class="mat-cell w-full m-2">No data to display</td>
    </tr>

</mat-table>
<mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
</mat-paginator>
</div>
  <ng-template #positionsskasLink>
   <!-- <app-fly-panel-link-position-task (closed)="flypanelSrvc.close()"></app-fly-panel-link-position-task> -->
   <!-- <app-fly-panel-add-ska (closed)="flypanelSrvc.close()"></app-fly-panel-add-ska> -->
   <app-fly-panel-link-position-employee  (refresh)="refreshData()"  (closed)="flypanelSrvc.close();refreshData();" [alreadyLinkedIds]="linkedEmps"></app-fly-panel-link-position-employee>

</ng-template>
<ng-template #unlinkModal>
  <app-qtd-dialogue header="Unlink  {{('Employee' | labelReplacement)| async}}(s)" [description]="unlinkDescription" cancelText="No" confirmText="Yes"
      [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()"  (confirmed)="getData($event)">

  </app-qtd-dialogue>
</ng-template>

<ng-template #linkedFlyPanel>
  <!-- <app-fly-panel-position-linked [EOID]="eoId" (closed)="flypanelSrvc.close()"></app-fly-panel-position-linked> -->
  <app-fly-panel-linked-positions  [Title]="title" [Id]="empId" selectedType="Employee"
  (closed)="flypanelSrvc.close()"></app-fly-panel-linked-positions>
</ng-template>
