<ng-container *ngIf="addRR">
  <div class="flex flex-col  px-12 py-12">
    <div class="flex flex-row justify-between items-center px-3 mt-2">
      <p *ngIf="oldId === undefined && !makeCopy" class="text-xl font-bold text-gray-900">Add New {{("Regulatory Requirement" | labelReplacement)| async}}s</p>
      <p *ngIf="oldId !== undefined && !makeCopy" class="text-xl font-bold text-gray-900">Edit {{("Regulatory Requirement" | labelReplacement)| async}}s</p>
      <p *ngIf="makeCopy" class="text-xl font-bold text-gray-900">Copy {{("Regulatory Requirement" | labelReplacement)| async}}s</p>
      <app-button [disabled]="showSpinner" (clicked)="closed.emit('fp-add-RR-closed')" ButtonType='icon' icon="close">
      </app-button>
    </div>

    <mat-stepper labelPosition="bottom" [linear]="true" #stepper [orientation]="(stepperOrientation | async)!">
      <!-- Change edit icon -->
      <ng-template matStepperIcon="edit">
        <app-icon icon="done"></app-icon>
      </ng-template>
      <mat-step [stepControl]="step1Form" [completed]="step1Form.valid" label="Assign Issuing Authority">
        <form class="flex flex-col" [formGroup]="step1Form">
          <div class="flex-col mt-3">
            <div *ngIf="oldId === undefined && !makeCopy" class="flex flex-row justify-between">
              <app-label [for]="'iaId'" [text]="'Issuing Authority '" class="label required"></app-label>
              <app-button variant="text" (clicked)="openIAPanel()" text="Add new Issuing Authority" icon="add"
                iconPosition="left">
              </app-button>
            </div>
            <mat-select (selectionChange)="selectIAId($event.value)" formControlName="iaId"
              placeholder="Select Issuing Authority" class="appearance-none rounded border w-full px-4 py-2.5 mt-2">
              <app-data-loader *ngIf="iaLoader"></app-data-loader>
              <mat-option *ngFor="let ia of issuingAuthorities" [value]="ia.id" [hidden]="!ia.active">
                {{ia.title}}
              </mat-option>
            </mat-select>
            <app-input-error *ngIf="step1Form.get('iaId')?.invalid" text="Issuing Authority is Required">
            </app-input-error>
          </div>
          <div class="self-end pt-12">
            <app-button [disabled]="step1Form.invalid" color="secondary" text="Continue" size="sm" (clicked)="stepper.next()"></app-button>
          </div>
        </form>
      </mat-step>
      <mat-step [completed]="step2Form.valid" label="Regulatory Req. Information">
        <form class="flex flex-col" [formGroup]="step2Form">
          <div class="mt-3">
            <app-label [for]="'number'" text="{{('Regulatory Requirement' | labelReplacement)| async}}s ID " class="label required"></app-label>
            <app-textbox [maxLength]="50" formControlName="number" placeholder="Enter Alpha/numeric">
            </app-textbox>
            <app-input-error *ngIf="step2Form.get('number')?.invalid" text="Number is Required">
            </app-input-error>
          </div>
          <div class="mt-3">
            <app-label [for]="'name'" text="{{('Regulatory Requirement' | labelReplacement)| async}}s Name " class="label required"></app-label>
            <app-textbox [maxLength]="200" formControlName="name" placeholder="">
            </app-textbox>
            <app-input-error *ngIf="step2Form.get('name')?.invalid" text="Title is Required">
            </app-input-error>
          </div>
          <div class="mt-3">
            <app-label [for]="'desc'" text="{{('Regulatory Requirement' | labelReplacement)| async}}s Description "></app-label>
            <app-textarea [value]="this.step2Form.get('desc')?.value || ''" formControlName="desc"
              placeholder="Please enter Description here">
            </app-textarea>
            <app-input-error *ngIf="step2Form.get('desc')?.invalid" text="Description is required"></app-input-error>
          </div>

          <div class="mt-3">
            <app-label [for]="'revNumber'" text="Revision Number"></app-label>
            <app-textbox formControlName="revNumber" placeholder="">
            </app-textbox>
          </div>
          <div class="mt-3">
            <div class="flex flex-grow">
              <app-label [for]="'hyperlink'" text="Hyperlink"></app-label>
              <p class="text-xs text-gray-400 ml-2">upload a PDF copy of the regulation or enter a
                hyperlink for
                the regulation</p>
            </div>
            <input (change)="fileChange(file.files)" hidden type="file" #file>
            <app-button *ngIf="!fileUploaded" (clicked)="file.click()" variant="text" icon="upload" iconPosition="left"
              text="Upload PDF"></app-button>
            <ng-container class="border-2 border-black" *ngIf="fileUploaded">
              <span>{{fileName}}</span>
              <button (click)="removeFile()">
                <app-icon icon="close"></app-icon>
              </button>
            </ng-container>

            <app-textbox *ngIf="!fileUploaded" formControlName="hyperlink" placeholder="Enter Hyperlink">
            </app-textbox>
          </div>
          <div class="self-end pt-12">
            <app-button [disabled]="step2Form.invalid" color="secondary" text="Continue" size="sm" (clicked)="stepper.next()"></app-button>
          </div>
        </form>
      </mat-step>
      <mat-step label="Revision and Date">
        <form class="flex flex-col" [formGroup]="step3Form">
          <div class="mt-3">
            <app-label [for]="'effectiveDate'" text="Effective Date"></app-label>
            <app-date  formControlName="effectiveDate"></app-date>
         <!--    <app-input-error *ngIf="dateError" text="Please Enter Valid date greater or equal to current date">
            </app-input-error> -->
          </div>
          <div class="mt-3">
            <app-label [for]="'reason'" text="Reason" class="label required"></app-label>
            <app-textarea [value]="step3Form.get('reason')?.value || ''" formControlName="reason" placeholder="Please enter Reasons for Revision here">
            </app-textarea>
            <app-input-error *ngIf="step3Form.get('reason')?.invalid" text="Reason for Revision is Required">
            </app-input-error>
          </div>
          <div class="flex flex-row justify-between pt-12">

            <div *ngIf="oldId === undefined" class="flex flex-row">
              <mat-checkbox  formControlName="AddAnother">
              </mat-checkbox>
              <span class="ml-1 pb-1">Add Another {{("Regulatory Requirement" | labelReplacement)| async}}s</span>
            </div>

            <app-button [spinner]="showSpinner" *ngIf="oldId === undefined && !makeCopy"
              [disabled]="step1Form.invalid || step2Form.invalid  || step3Form.invalid || showSpinner" (clicked)="saveRRData()"
              text="Save" size="sm"></app-button>

          </div>

          <div class="flex flex-row-reverse">

            <app-button [spinner]="showSpinner" *ngIf="oldId !== undefined && !makeCopy"
              [disabled]="step1Form.invalid || step2Form.invalid  || step3Form.invalid || showSpinner"
              (clicked)="updateRRData()" text="Update" size="sm"></app-button>

            <app-button [spinner]="showSpinner" *ngIf="makeCopy"
              [disabled]="step1Form.invalid || step2Form.invalid || step3Form.invalid || showSpinner" (clicked)="copyRRData()"
              text="Copy" size="sm"></app-button>

          </div>
        </form>

      </mat-step>

    </mat-stepper>
  </div>
</ng-container>



<app-fly-panel-add-rr-issuing-authority (refreshRRIA)="refreshRRIAData()" *ngIf="addIA" (closed)="closeIAPanel()">
</app-fly-panel-add-rr-issuing-authority>
