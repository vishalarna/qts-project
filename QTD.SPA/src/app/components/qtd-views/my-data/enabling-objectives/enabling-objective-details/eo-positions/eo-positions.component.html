<div class="flex flex-row flex-wrap mt-3 justify-between">
  <div class="flex flex-col">
    <p class="font-bold text-lg">Linkages: {{("Position" | labelReplacement)| async}}s</p>
    <p class="text-xs text-gray-four">{{srcList.length}} {{("Position" | labelReplacement)| async}}s linked to selected SQ</p>
  </div>
  <app-button (clicked)="openFlyPanel(positionPanel)" [disabled]="!isActive || spinner" variant="text" icon="link"
    iconPosition="left" text="Link  {{('Position' | labelReplacement)| async}}">
  </app-button>
</div>

<app-data-loader *ngIf="!DataSource"></app-data-loader>
<div class="shadow-md" *ngIf="DataSource">
  <div class="flex flex-row flex-wrap bg-gray-one justify-between mb-3 mt-3  px-3 py-3 rounded"
    *ngIf="unlinkIds.length > 0">
    <p class="text-xs text-gray-four pt-2">{{unlinkIds.length}} {{("Position" | labelReplacement)| async}}s selected</p>
    <app-button (clicked)="unlinkItemsModal(unlinkModal)" icon="link_off" iconPosition="left" size="sm"
      color="secondary" text="Unlink {{('Position' | labelReplacement)| async}}">
    </app-button>
  </div>
  <mat-table [dataSource]="DataSource" matSort class="table-bordered" >
    <ng-container matColumnDef="id">
      <mat-header-cell *matHeaderCellDef>
        <mat-checkbox [disabled]="!isActive || spinner" (change)="$event ? masterToggle() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()">
        </mat-checkbox>
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <mat-checkbox [disabled]="!isActive || spinner" (click)="$event.stopPropagation()"
          (change)="$event ? selectrow(row) : null" [checked]="selection.isSelected(row)">
        </mat-checkbox>
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="number">
      <mat-header-cell *matHeaderCellDef>
        <span>#</span>
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        <span>{{row.position.positionNumber}}</span>
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="description">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Description
      </mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{row.position.positionTitle}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="linkageCount">
      <mat-header-cell *matHeaderCellDef mat-sort-header> # of linkages
      </mat-header-cell>
      <mat-cell *matCellDef="let row" class="flex flex-row justify-between cursor-pointer">
        <app-button
          (clicked)="selectedNumber = row.position.positionNumber;selectedTitle = row.position.positionTitle;selectedId = row.position.id;openFlyPanel(linkedPanel)"
          variant="text" [text]="row.count">
        </app-button>
        <app-button [disabled]="!isActive || spinner" ButtonType="icon" icon="link_off" style="color:lightgray"
          (clicked)="unlinkItemsModal(unlinkModal,row.position.id)"></app-button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayColumns;" [class.inActiveItem]="!row.position.active"></mat-row>

    <!-- Row shown when there is no matching data.-->
    <tr class="mat-row flex text-center " *matNoDataRow>
      <td class="mat-cell w-full m-2">No data to display</td>
    </tr>

  </mat-table>
  <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
  </mat-paginator>
</div>

<ng-template #unlinkModal>
  <app-qtd-dialogue header="Unlink {{('Position' | labelReplacement)| async}}" [description]="unlinkDescription" cancelText="No" confirmText="Yes"
    [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="getData($event)">
  </app-qtd-dialogue>
</ng-template>

<ng-template #positionPanel>
  <app-flypanel-eo-position-link [alreadyLinkedIds]="linkedPosIds" (refresh)="getPositions()"
    (closed)="flyPanelService.close()"></app-flypanel-eo-position-link>
</ng-template>

<ng-template #linkedPanel>
  <app-flypanel-linked-eos (closed)="flyPanelService.close()" [selectedTypeNumber]="selectedNumber"
    [selectedType]="'Position'" [Id]="selectedId" [Title]="selectedTitle"></app-flypanel-linked-eos>
</ng-template>
