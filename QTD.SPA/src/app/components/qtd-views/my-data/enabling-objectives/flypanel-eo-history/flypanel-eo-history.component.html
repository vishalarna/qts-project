<div *ngIf="!isVersion" class="flex flex-col px-12 py-12">
  <div class="flex flex-row justify-between">
    <h2 class="mb-5">{{("Enabling Objective" | labelReplacement)| async}} History</h2>
    <app-button (click)="flyPanelSrvc.close()" ButtonType='icon' icon="close"></app-button>
  </div>
<!--   <h2 class="mb-5">{{("Enabling Objective" | labelReplacement)| async}} History</h2>
 -->  <div class="flex flex-row items-center border-b-0.8 border-gray-one mb-3">

    <div class="flex flex-grow">
      <app-icon icon="search"></app-icon>
      <input class="text-sm flex-grow focus:outline-none" placeholder="Search" type="text" (input)="filterData($event)" [(ngModel)]="clearSearch">
      <app-icon icon="close" class="cursor-pointer" (click)="clearFilter()"></app-icon>
    </div>

  </div>
  <app-data-loader *ngIf="appSpinner"></app-data-loader>
  <div class="border-gray-one shadow-xs border-0.5 rounded">
    <mat-table [dataSource]="dataSource" matSort *ngIf="dataSource" (matSortChange)="sortData($event)" >
      <ng-container matColumnDef="title">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{("Enabling Objective" | labelReplacement)| async}} Number/Name </mat-header-cell>
        <mat-cell *matCellDef="let row"> {{row.title}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="activityDesc">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Description of Change </mat-header-cell>
        <mat-cell *matCellDef="let row"> {{row.activityDesc}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="createdDate">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Modified By </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <div class="flex flex-col">
            <span class="text-qtd" style="line-break: anywhere;">{{row.createdBy}}</span>
            <span class="mt-2">{{row.createdDate | date:'medium' }}</span>
          </div>
        </mat-cell>
      </ng-container>
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

      <!-- Row shown when there is no matching data.-->
      <tr class="mat-row flex text-center " *matNoDataRow>
        <td class="mat-cell w-full m-2">No data matching the filter</td>
      </tr>

    </mat-table>

    <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
    </mat-paginator>
  </div>
</div>

<div *ngIf="isVersion && (!viewVersion && !compareVersion)" class="flex flex-col px-12 py-12">
  <div class="flex flex-row justify-between">
    <p class="mb-5 text-lg"><b>{{Number}}</b> {{Title}} - <b>History</b></p>
    <app-button ButtonType="icon" icon="close" class="cursor-pointer" (click)="flyPanelSrvc.close()"></app-button>
  </div>
  <div class="flex flex-row items-center border-b-0.8 border-gray-one mb-3">

    <div class="flex flex-grow">
      <app-icon icon="search"></app-icon>
      <input class="text-sm flex-grow focus:outline-none" placeholder="Search" type="text" (input)="filterData($event)">

    </div>

  </div>
  <div *ngIf="selection.selected.length > 1"
    class="p-3 mt-3 mb-3 bg-gray-one rounded w-full flex flex-row justify-between">
    <span class="mt-3">Version {{selection.selected[0].versionNumber}} and {{selection.selected[1].versionNumber}}
      selected for comparison</span>
    <app-button (clicked)="compareLogic()" type="button" color="secondary" size="sm" text="Compare"></app-button>
  </div>
  <div *ngIf="eoId" class="border-gray-one shadow-xs border-0.5 rounded w-full">
    <mat-table [dataSource]="dataSource" #verSort="matSort" matSort *ngIf="dataSource">
      <ng-container matColumnDef="versionNumber">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Version </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <div class="flex flex-row">
            <mat-checkbox [checked]="selection.selected.includes(row)" (change)="selectionChanged($event,row)"
              class="m-2"></mat-checkbox>
            <div class="flex flex-col ml-2">
              <span>{{row.versionNumber}}</span>
              <span *ngIf="row.isInUse" class="text-qtd">Current</span>
            </div>
          </div>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="createdDate">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Effective Date </mat-header-cell>
        <mat-cell *matCellDef="let row"> {{row.createdDate | date : 'shortDate'}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="createdBy">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Change/By </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <span style="line-break:anywhere;">{{row.createdBy}}</span>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <div class="flex flex-row">
            <app-button (clicked)="toView = row;viewVersion = true;" size="sm"
              color="secondary" text="View"></app-button>
          </div>
        </mat-cell>
      </ng-container>
      <mat-header-row *matHeaderRowDef="displayedColumnsHistory"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumnsHistory;"></mat-row>

      <!-- Row shown when there is no matching data.-->
      <tr class="mat-row flex text-center " *matNoDataRow>
        <td class="mat-cell w-full m-2">No data matching the filter</td>
      </tr>

    </mat-table>

    <mat-paginator [pageSizeOptions]="[ 10, 20]" showFirstLastButtons aria-label="Select page of periodic elements">
    </mat-paginator>
  </div>
</div>

<!-- View Version Starts Here -->
<div *ngIf="viewVersion" class="flex flex-col px-12 py-12">
  <div class="flex flex-row justify-between">
    <p class="mb-5 text-lg"><b>{{Number}}</b> {{Title}} - <b>History</b></p>
    <app-button ButtonType="icon" icon="close" class="cursor-pointer" (click)="viewVersion = false"></app-button>
  </div>
  <div class="flex flex-row ml-3">
    <div class="flex flex-col mr-5">
      <span class="text-sm" style="color:gray;">Version</span>
      <span class="mt-3 text-sm">{{toView.versionNumber}}</span>
    </div>
    <div class="flex flex-col mr-5">
      <span class="text-sm" style="color:gray;">Effective Date</span>
      <span class="mt-3 text-sm">{{toView.createdDate | date : 'shortDate'}}</span>
    </div>
    <div class="flex flex-col">
      <span class="text-sm" style="color:gray;">Change/By</span>
      <span class="mt-3 text-sm">{{toView.createdBy}}</span>
    </div>
  </div>
  <span class="mb-3 ml-3 mt-5">
    Revision Summary
  </span>
  <div class="p-3 ml-4 mt-3 mb-3 bg-gray-one rounded w-full flex flex-col">
    <div class="flex flex-row" *ngFor="let item of toView.enablingObjectiveHistories">
      <span class="text-sm" style="color:gray;">{{item.changeNotes}}</span>
    </div>
  </div>
</div>


<!-- Comarison Starts Here -->
<div *ngIf="compareVersion" class="flex flex-col px-12 py-12">
  <div class="flex flex-row justify-between mb-4">
    <div class="flex flex-row" style="align-items: center;">
      <app-button ButtonType="icon" icon="keyboard_arrow_left" class="cursor-pointer mr-3 mb-4"
        (clicked)="compareVersion = false"></app-button>
      <p class="text-lg"><b>History Comparison</b></p>
    </div>
    <app-button ButtonType="icon" icon="close" class="cursor-pointer" (click)="flyPanelSrvc.close()"></app-button>
  </div>
  <div class="flex flex-col">
    <p class="text-lg font-bold">Version {{selection.selected[0].versionNumber}} and
      {{selection.selected[1].versionNumber}} comparison</p>
    <p class="text-xs font-extralight text-gray-400">Following changes have been made in latest version
      {{orderedVersions[0]}} as compared to {{orderedVersions[1]}}</p>
  </div>
  <div class="flex flex-col">
    <div class="flex flex-row" style="align-items: center;">
      <mat-icon class="mb-3 mr-2">add</mat-icon>
      <p class="text-lg">Addition</p>
    </div>
    <div class="shadow-sm border rounded-md">
      <div class="p-4" *ngIf="toView.enablingObjectiveHistories.length < 1 || toView.state !== 1">
        No New Additions
      </div>
      <div *ngIf="toView.state === 1">
        <div class="flex flex-col p-4" *ngFor="let item of toView.enablingObjectiveHistories">
          <p>{{item.changeNotes}}</p>
          <div class="flex flex-row">
            <span class="ml-2 mr-4">{{item.changeEffectiveDate | date : 'shortDate'}}</span>
            <span class="mr-4">{{item.changeEffectiveDate | date : 'shortTime'}}</span>
            <span>{{item.createdBy}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="flex flex-col mt-3">
    <div class="flex flex-row" style="align-items: center;">
      <mat-icon class="mb-3 mr-2">delete</mat-icon>
      <p class="text-lg">Removal</p>
    </div>
    <div class="shadow-sm border rounded-md">
      <div class="p-4" *ngIf="toView.enablingObjectiveHistories.length < 1 || toView.state !== 0">
        No New Removals
      </div>
      <div *ngIf="toView.state === 0">
        <div class="flex flex-col p-4" *ngFor="let item of toView.enablingObjectiveHistories">
          <p>{{item.changeNotes}}</p>
          <div class="flex flex-row">
            <span class="ml-2 mr-4">{{item.changeEffectiveDate | date : 'shortDate'}}</span>
            <span class="mr-4">{{item.changeEffectiveDate | date : 'shortTime'}}</span>
            <span>{{item.createdBy}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="flex flex-col mt-3">
    <div class="flex flex-row" style="align-items: center;">
      <mat-icon class="mb-3 mr-2">update</mat-icon>
      <p class="text-lg">Update</p>
    </div>
    <div class="shadow-sm border rounded-md">
      <div class="p-4" *ngIf="toView.enablingObjectiveHistories.length < 1 || toView.state !== 2">
        No New Updates
      </div>
      <div *ngIf="toView.state === 2">
        <div class="flex flex-col p-4" *ngFor="let item of toView.enablingObjectiveHistories">
          <p>{{item.changeNotes}}</p>
          <div class="flex flex-row">
            <span class="ml-2 mr-4">{{item.changeEffectiveDate | date : 'shortDate'}}</span>
            <span class="mr-4">{{item.changeEffectiveDate | date : 'shortTime'}}</span>
            <span>{{item.createdBy}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
