<mat-dialog-content>
  <div class="w-full h-full">
    <app-data-loader *ngIf="startLoading"></app-data-loader>
  </div>

  <ng-container *ngIf="!startLoading">
    <div class="flex flex-row justify-between items-center mt-2 mb-8" style="width: 100%;height:100%">
      <p mat-dialog-title textContent="Collaborate on {{('Task' | labelReplacement)| async}}"></p>
      <!-- <app-textbox mat-dialog-title [(ngModel)]="header" [disabled]="true"></app-textbox> -->
      <app-button ButtonType='icon' class="mt--4" icon="close" mat-dialog-close="true"></app-button>
    </div>

    <div #posContainer class="mt-3">
      <div>
        <div>
          <h4 class="font-semibold">Select Personnel</h4>
          <mat-select placeholder="Select {{('Employee' | labelReplacement)| async}} to add to list" [(ngModel)]="initial" (selectionChange)="onSelectionChanged($event)"
            class="appearance-none rounded border w-full px-4 py-3 text-black" id="Personnel_Selection"
            name="Personnel Selection">
            <mat-option *ngFor="let employee of employees" [disabled]="dataSource.data.includes(employee.person)"
              [value]="employee.person">
              {{employee.person.firstName + " " + employee.person.lastName}}
            </mat-option>
          </mat-select>
        </div>
        <div>
          <h4 class="mt-4">Invite</h4>
          <app-textbox (changed)="inputChanged($event)" [(ngModel)]="emailField" placeholder="Email, comma separated"
            class="appearance-none rounded w-full text-gray-400">
          </app-textbox>
          <app-input-error *ngIf="hasEmailError" text="Invalid Email Detected"></app-input-error>
        </div>
      </div>
      <div>
        <ng-container class="ml-5 w-full">
          <mat-table [dataSource]="dataSource" class="w-full mt-5">
            <ng-container matColumnDef="name">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Name
              </mat-header-cell>
              <mat-cell *matCellDef="let row"> {{row.firstName + " " + row.lastName}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="email">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Email
              </mat-header-cell>
              <mat-cell *matCellDef="let row"> {{row.username}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="userPermissions">
              <mat-header-cell *matHeaderCellDef mat-sort-header>
                Roles/Permissions
              </mat-header-cell>
              <mat-cell style="color: rgb(92, 155, 49) !important" *matCellDef="let row">
                <mat-select [value]="1" [id]="row.id" (selectionChange)="onPermissionSelectionChanged($event,row.id)"
                  class="appearance-none rounded border w-full px-4 py-3 text-black" id="Personnel_Selection"
                  name="Personnel Selection">
                  <mat-option [value]="0">
                    Edit
                  </mat-option>
                  <mat-option [value]="1">
                    Read Only
                  </mat-option>
                </mat-select>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="actions">
              <mat-header-cell *matHeaderCellDef>
              </mat-header-cell>
              <mat-cell *matCellDef="let row">
                <!-- <app-icon icon="edit" class="ml-2"></app-icon> -->
                <app-button (clicked)="deletePerson(row)" icon="delete" class="ml-2" variant="text" size="sm">
                </app-button>
              </mat-cell>
            </ng-container>
            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
        </ng-container>
      </div>
      <div>
        <h4 class="mt-4">Message (Optional)</h4>
      </div>
      <div>
        <ckeditor [(ngModel)]="message" [editor]="Editor"></ckeditor>
      </div>
    </div>
    <mat-dialog-actions class="flex flex-row justify-end">

      <app-button [disabled]="hasEmailError || dataSource.data.length < 1" (clicked)="getData()" class="share_button"
        variant="contained" color="secondary" text="Share" [mat-dialog-close]="false">
      </app-button>
    </mat-dialog-actions>
  </ng-container>

</mat-dialog-content>
