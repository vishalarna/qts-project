<div class="flex flex-row flex-wrap mt-3 justify-between">
  <div class="flex flex-col">
      <p class="font-bold text-lg">Linkages: {{("Enabling Objective" | labelReplacement)| async}}</p>
      <p class="text-xs text-gray-four">{{enablingObjectives?.length}} {{("Enabling Objective" | labelReplacement)| async}} linked to selected {{("Task" | labelReplacement)| async}}</p>
  </div>
  <app-button *ngIf="isMeta && isEMPView===false" [disabled]="isActive" variant="text" icon="link" iconPosition="left" text="Link {{('Enabling Objective' | labelReplacement)| async}}s"
      (clicked)="openLinkFlypanel(linkEO)" ></app-button>
</div>

<app-data-loader *ngIf="!DataSource"></app-data-loader>
<div class="shadow-md" *ngIf="DataSource">
  <div class="flex flex-row flex-wrap bg-gray-one justify-between mb-3 mt-3  px-3 py-3 rounded"
      *ngIf="unlinkIds.length > 0">
      <p class="text-xs text-gray-four pt-2">{{unlinkIds.length}} {{("Enabling Objective" | labelReplacement)| async}} selected</p>
      <app-button *ngIf="isMeta" [disabled]="isActive || showLinkLoader" icon="link_off" iconPosition="left" size="sm" color="secondary" text="Unlink {{('Enabling Objective' | labelReplacement)| async}}"
          (clicked)="unlinkItemsModal(unlinkModal)"  [spinner]="showLinkLoader">
      </app-button>
  </div>
  <mat-table [dataSource]="DataSource" matSort class="table-bordered " (matSortChange)="sortData($event)">
      <ng-container matColumnDef="id">
          <mat-header-cell *matHeaderCellDef>
              <mat-checkbox [disabled]="isActive && isMeta || isEMPView === true" (change)="$event ? masterToggle() : null"
                  [checked]="selection.hasValue() && isAllSelected()"
                  [indeterminate]="selection.hasValue() && !isAllSelected()">
              </mat-checkbox>
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
              <mat-checkbox [disabled]="isActive && isMeta || isEMPView === true" (click)="$event.stopPropagation()" (change)="$event ? selectrow(row) : null"
                  [checked]="selection.isSelected(row)">
              </mat-checkbox>
          </mat-cell>
      </ng-container>
      <ng-container matColumnDef="number">
          <mat-header-cell *matHeaderCellDef mat-sort-header> #
          </mat-header-cell>
          <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active"> {{row.number}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="description">
          <mat-header-cell *matHeaderCellDef mat-sort-header> Description
          </mat-header-cell>
          <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active">
              {{row.description}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="linkCount">
          <mat-header-cell *matHeaderCellDef mat-sort-header> # of linkages
          </mat-header-cell>
          <mat-cell *matCellDef="let row" [class.inActiveItem]="!row.active" class="cursor-pointer flex flex-row justify-between">
              <label style="color:rgba(92, 155, 49, 1)"  (click)="title=row.description;eoId=row.id;openLinkedFlypanel(linkedFlyPanel,row)">
                {{row.linkCount}}
              </label>
              <app-button *ngIf="isMeta" [disabled]="isActive || isEMPView === true" ButtonType="icon" icon="link_off" style="color:lightgray"
                  (clicked)="unlinkItemsModal(unlinkModal,row.id)">
              </app-button>
          </mat-cell>
      </ng-container>


      <ng-container>
          <mat-header-cell *matHeaderCellDef mat-sort-header>
          </mat-header-cell>
          <mat-cell *matCellDef="let row" [matTooltip]="'Unlink ' + (('Enabling Objective' | labelReplacement) | async) + 's'">
              <app-icon icon="link_off"></app-icon>
          </mat-cell>
      </ng-container>
      <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayColumns;" [class.inActiveItem]="!row.active"></mat-row>

      <!-- Row shown when there is no matching data.-->
      <tr class="mat-row flex text-center " *matNoDataRow>
          <td class="mat-cell w-full m-2">No data to display</td>
      </tr>

  </mat-table>
  <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
  </mat-paginator>
</div>

<ng-template #unlinkModal>
  <app-qtd-dialogue header="Unlink {{('Enabling Objective' | labelReplacement)| async}}" [description]="unlinkDescription" cancelText="No"
      confirmText="Yes" [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()"
      (confirmed)="getData($event)">
  </app-qtd-dialogue>
</ng-template>

<ng-template #linkEO>
  <app-fly-panel-task-eos-link [alreadyLinked]="linkedTasks" (refresh)="refreshData()" (closed)="flypanelSrvc.close()"></app-fly-panel-task-eos-link>
</ng-template>

<ng-template #linkedFlyPanel>
  <app-fly-panel-linked-tasks [id]="eoId" [Title]="title" [EONumber]="EONumber" [selectedType]="'enabling objective'" (closed)="flypanelSrvc.close()"></app-fly-panel-linked-tasks>
</ng-template>
