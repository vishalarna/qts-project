<div class="flex flex-row flex-wrap mt-3 justify-between">
    <div class="flex flex-col">
        <p class="font-bold text-lg">Linkages:  {{("Position" | labelReplacement)| async}}s</p>
        <p class="text-xs text-gray-four">{{srcList.length}}  {{("Position" | labelReplacement)| async}}s linked to selected {{("Task" | labelReplacement)| async}}</p>
    </div>
    <app-button *ngIf="isMeta && isEMPView===false" [disabled]="!isActive" variant="text" icon="link" iconPosition="left" text="Link {{('Position' | labelReplacement)| async}}s" (clicked)="openFlypanel(taskPos)">
    </app-button>
</div>

<app-data-loader *ngIf="!DataSource"></app-data-loader>
<div class="shadow-md" *ngIf="DataSource">
    <div class="flex flex-row flex-wrap bg-gray-one justify-between mb-3 mt-3  px-3 py-3 rounded"
        *ngIf="unlinkIds.length > 0">
        <p class="text-xs text-gray-four pt-2">{{unlinkIds.length}} {{("Position" | labelReplacement)| async}}s selected</p>
        <app-button *ngIf="isMeta " icon="link_off" iconPosition="left" size="sm" color="secondary" text="Unlink {{('Position' | labelReplacement)| async}}" 
            (clicked)="unlinkItemsModal(unlinkModal)">
        </app-button>
    </div>
    <mat-table [dataSource]="DataSource" matSort class="table-bordered" (matSortChange)="sortData($event)">
        <ng-container matColumnDef="id">
            <mat-header-cell *matHeaderCellDef>
                <mat-checkbox [disabled]="!isActive  && isMeta || isEMPView === true" (change)="$event ? masterToggle() : null"
                    [checked]="selection.hasValue() && isAllSelected()"
                    [indeterminate]="selection.hasValue() && !isAllSelected()">
                </mat-checkbox>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
                <mat-checkbox [disabled]="!isActive  && isMeta || isEMPView === true" (click)="$event.stopPropagation()" (change)="$event ? selectrow(row) : null"
                    [checked]="selection.isSelected(row)">
                </mat-checkbox>
            </mat-cell>
        </ng-container>
        <ng-container matColumnDef="abbreviation">
            <mat-header-cell *matHeaderCellDef mat-sort-header>  {{("Position" | labelReplacement)| async}}s Abbreviation
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
                {{row.abbreviation}} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="description">
            <mat-header-cell *matHeaderCellDef mat-sort-header>  {{("Position" | labelReplacement)| async}}s Title
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
                {{row.description}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="linkageCount">
            <mat-header-cell *matHeaderCellDef mat-sort-header> # of Linkages
            </mat-header-cell>
            <mat-cell *matCellDef="let row" class="cursor-pointer flex flex-row justify-between"> 
               
                    <app-button variant="text" [text]="row.linkageCount" (clicked)="openFlypanel(linkedtoTask,row)">
                    </app-button>
                    <app-button *ngIf="isMeta" [disabled]="!isActive || isEMPView === true" ButtonType="icon" icon="link_off" style="color:lightgray"
                        (clicked)="unlinkItemsModal(unlinkModal,row.id)"></app-button>
              
                
                </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayColumns;" [class.inActiveItem]="!row.active"></mat-row>

        <!-- Row shown when there is no matching data.-->
        <tr class="mat-row flex text-center " *matNoDataRow>
            <td class="mat-cell w-full m-2">No data to display</td>
        </tr>

    </mat-table>
    <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons aria-label="Select page of periodic elements">
    </mat-paginator>
</div>
<ng-template #taskPos>
    <app-fly-panel-task-pos-link [alreadyLinkedIds]="linkedPosIds" (closed)="flyPanelService.close()"
        (refresh)="getTaskLinkedPositions();dataBroadcastService.refreshTaskStats.next(null);">
    </app-fly-panel-task-pos-link>
</ng-template>

<ng-template #unlinkModal>
    <app-qtd-dialogue header="Unlink  {{('Position' | labelReplacement)| async}}" [description]="unlinkDescription" cancelText="No" confirmText="Yes"
        [showEffectiveDateAndReason]="true" (canceled)="dialog.closeAll()" (confirmed)="getData($event)">
    </app-qtd-dialogue>
</ng-template>


<ng-template #linkedtoTask>
    <app-fly-panel-linked-tasks (closed)="flyPanelService.close()" [posAbbrevation]="posAbbrevation" [selectedType]="'position'" [Title]="Title"
        [id]="posId"></app-fly-panel-linked-tasks>
</ng-template>
