<app-header title="{{'Reports' | translate}}" [canGoBack]="false"></app-header>
<section class="panel-section">
    <div class="panel-spin" *ngIf="!this.reportSkeletonData">
            <app-spinner *ngIf="!this.reportSkeletonData" color="rgb(92, 155, 49)" class="spin-center items-center"></app-spinner>
        </div>

            <div class="container ng-container" *ngIf="this.reportSkeletonData">
        <div class="row">
            <div class="col-md-4 mt-3">
                <div class="reports-comp-sidebar">
                    <div class="flex flex-col text-sm p-2">
                        <span class="skeleton-box-header"><b>{{this.reportSkeletonCategory?.name}}</b></span>
                        <div>
                            <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="qtd-tree">
                                <mat-tree-node 
                                 *matTreeNodeDef="let node" >
                                    <ng-container>
                                        <div class="tree-wrapper" [ngClass]="{'active_menu':(selectedItem && selectedItem.id === node.id)}">
                                            <app-label (click)="itemClicked(node)" [text]="(node.Title|dynamicLabelReplacement)|async " customClasses="cursor-pointer mb-0 font-italic">
                                            </app-label>
                                        </div>
                                    </ng-container>
                                </mat-tree-node>
                                <!-- This is the tree node template for expandable nodes -->
                                <mat-nested-tree-node *matTreeNodeDef="let node;when: hasChild">
                                    <li class="tree-node-list">
                                        <div class="mat-tree-node">
                                            <button
                                              mat-icon-button
                                              matTreeNodeToggle
                                              [attr.aria-label]="'toggle ' + node.Title"
                                              class="pt-1"
                                            >
                                              <mat-icon class="mat-icon-rtl-mirror">
                                                {{
                                                  treeControl.isExpanded(node)
                                                    ? 'expand_more'
                                                    : 'chevron_right'
                                                }}
                                              </mat-icon>
                                            </button>
                                            {{ (node.Title | dynamicLabelReplacement)|async }}
                                          </div>
                                          <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                                            <ng-container matTreeNodeOutlet></ng-container>
                                          </ul>
                                    </li>

                                </mat-nested-tree-node>
                            </mat-tree>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="flex flex-col mt-3">
                    <div class="row m-0 justify-content-between align-items-center pb-3">
                        <div class="panel-heading">
                            Reports
                        </div>
                        <div class="d-flex text-gray-four btn-group" *ngIf="isCreateVisible">
                            <button type="button" class="btn btn-success" (click)="openEditReportsPage('create', reportSkeletonId)">Create New</button>
                        </div>
                    </div>
                    <div class="
                        flex flex-row
                        bg-white-one
                        rounded-t-md
                        py-4
                        px-6
                        space-x-2
                        border-b-0.8 border-gray-one
                        w-full
                      ">
                        <svg class="flex-none w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input class="text-sm flex-grow focus:outline-none" placeholder="Enter keywords to search"
                            type="text" (keyup)="filterReport($event)" />
                        <div class="flex flex-row space-x-4 text-sm"></div>
                    </div>
                </div>
                <mat-table [dataSource]="reportDetails" matSort class="manager-table">
                    <ng-container matColumnDef="Official Report Title">
                        <mat-header-cell *matHeaderCellDef mat-sort-header> Official Report Title
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{(row.officialReportTitle | dynamicLabelReplacement) | async}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="Internal Report Title">
                        <mat-header-cell *matHeaderCellDef mat-sort-header> Internal Report Title
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.internalReportTitle}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="Category">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Category
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.category}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="Last Run">
                        <mat-header-cell *matHeaderCellDef mat-sort-header>Last Run
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            {{ (row.lastRunDate | dateFormat | async) || 'Never Ran' }} &nbsp;&nbsp;
                            <app-button color="secondary" variant="outlined" size="sm" class="mr-3" text="View"
                                iconPosition="right" (clicked)="openEditReportsPage('update', row.id)">
                            </app-button>
                        </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                    <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
                    <!-- Row shown when there is no matching data.-->
                    <tr class="mat-row flex text-center" *matNoDataRow>
                        <td class="mat-cell w-full">No Data</td>
                    </tr>
                </mat-table>
            </div>
        </div>
    </div>
</section>