<div>
  <!-- Filter and header section -->
  <section class="flex flex-row pb-2 pt-4 justify-between" style="align-items:center;">
    <span class="text-xl font-bold">{{("Task" | labelReplacement)| async}} & Skill Qualifications {{filterBy ?? ""}}</span>
    <app-button [matMenuTriggerFor]="filterMenu" ButtonType="button" color="secondary" icon="filter_alt" size="sm"
      iconPosition="left" text="Filter"></app-button>

    <mat-menu #filterMenu="matMenu" backdropClass="qtd__menu">
      <label (click)="openFlypanel(filterPanel)" mat-menu-item>By {{("Task" | labelReplacement)| async}}</label>
      <label (click)="openFlypanel(filterEMPPanel)" mat-menu-item>By {{("Employee" | labelReplacement)| async}}</label>
    </mat-menu>
  </section>

  <section *ngIf="!filterOptions" class="flex flex-row w-full mt-5" style="justify-content: center;align-items:center;">
    <span>To get started working with Task & Skill Qualification data, click the Filter button.</span>
  </section>

  <section *ngIf="filterOptions" class="mt-3 flex flex-col w-full rounded-sm border-gray-one mat-elevation-z8"
    style="background:white;">
    <mat-form-field appearance="outline">
      <mat-icon matPrefix>search</mat-icon>
      <input (input)="inputChange()" [(ngModel)]="filterString" type="text" matInput
        placeholder="Enter keywords to search">
    </mat-form-field>
    <table [matSortActive]="active" [matSortDirection]="direction" matSort (matSortChange)="sortChange($event)" style="border-top:0.8px solid #E1E5E4" mat-table [dataSource]="dataSource">
      <!-- <ng-container matColumnDef="cb">
        <th style="width:5%;" mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="masterToggle($event)"
            [indeterminate]="selection.selected.length > 0 && selection.selected.length < dataSource.data.length"
            [checked]="dataSource.data.length > 0 && selection.selected.length === dataSource.data.length"></mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox [checked]="selection.selected.includes(row)" (change)="checkChange($event,row)"></mat-checkbox>
        </td>
      </ng-container> -->
      <ng-container matColumnDef="taskNumber">
        <th mat-sort-header style="width:5%" mat-header-cell *matHeaderCellDef>
          {{("Task" | labelReplacement)| async}} #
        </th>
        <td mat-cell *matCellDef="let row">
          {{row.taskNumber}}
        </td>
      </ng-container>
      <ng-container matColumnDef="taskDescription">
        <th mat-sort-header style="width:30%" mat-header-cell *matHeaderCellDef>
          Description
        </th>
        <td mat-cell *matCellDef="let row">
          <span>{{row.taskDescription}}</span>
        </td>
      </ng-container>
      <ng-container *ngIf="hasPositionFilter" matColumnDef="position">
        <th mat-sort-header style="width:30%" mat-header-cell *matHeaderCellDef>
          {{("Position" | labelReplacement) | async}}
        </th>
        <td mat-cell *matCellDef="let row">
          <span>{{row.position}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="empLinkCount">
        <th mat-sort-header style="width:10%" mat-header-cell *matHeaderCellDef>
          {{("Employee" | labelReplacement)| async}}s Linked
        </th>
        <td class="linkText" mat-cell *matCellDef="let row">
          <span (click)="routeToRequal(row)" class="cursor-pointer">{{row.empLinkCount | number:'2.0'}}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="requalificationRequired">
        <th mat-sort-header style="width:12%" mat-header-cell *matHeaderCellDef>
          Requalification Required
        </th>
        <td mat-cell *matCellDef="let row">
          {{row.requalificationRequired ? 'YES':'NO'}}
        </td>
      </ng-container>
      <ng-container matColumnDef="dueDate">
        <th mat-sort-header style="width:10%" mat-header-cell *matHeaderCellDef>
          Requalification Due Date
        </th>
        <td mat-cell *matCellDef="let row">
          {{row.dueDate === null ? "N/A" : (row.dueDate | date:'M/d/yy')}}
        </td>
      </ng-container>
      <ng-container matColumnDef="action">
        <th style="width:5%" mat-header-cell *matHeaderCellDef>
        </th>
        <td mat-cell *matCellDef="let row">
          <app-icon icon="more_horiz" class="text-gray-400 cursor-pointer"></app-icon>
        </td>
      </ng-container>

      <tr mat-header-row class="pl-2 pr-2" *matHeaderRowDef="hasPositionFilter ? displayedColumnsPos:displayedColumns"></tr>
      <tr mat-row class="pr-2 pl-2" *matRowDef="let row; columns: hasPositionFilter ? displayedColumnsPos:displayedColumns"></tr>
      <!-- Row shown when there is no matching data.-->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">No {{("Task" | labelReplacement)| async}} Qualifications Found</td>
      </tr>
    </table>
    <mat-paginator [showFirstLastButtons]="true" [pageSizeOptions]="[20,40,60]">

    </mat-paginator>
  </section>
</div>

<ng-template #filterPanel>
  <app-flypanel-task-requal-filter [filterUsed]="filterOptions"
    (filter)="getWithFilter($event);flyPanelService.close();"
    (closed)="flyPanelService.close()"></app-flypanel-task-requal-filter>
</ng-template>

<ng-template #filterEMPPanel>
  <app-flypanel-task-requal-filter-by-emp (empselected)="empId = $event"
    (closed)="flyPanelService.close();"></app-flypanel-task-requal-filter-by-emp>
</ng-template>
