<div class="flex flex-row w-full">
  <div class="flex flex-col w-full">
    <form [formGroup]="evalForm" class="flex flex-col w-full">
      <div class="flex flex-col w-full">
        <div class="flex flex-col w-full">
          <app-label [text]="'Select Student Evaluation to view '+ (('Employee' | labelReplacement)| async) +' Results'" class="label required"></app-label>
          <mat-select (selectionChange)="emitChange()" [ngClass]="{'disable-select': !evals || evals.length === 0 }"
            formControlName="eval"
            style="width: 49%"
            class="
              appearance-none
              rounded
              border
              w-full
              px-4
              py-2.5
              align-item-end
              bg-white
              " [disabled]="!evals || evals.length === 0
            "
          >
            <mat-option [value]="eval.id" *ngFor="let eval of evals">
              {{ eval.title }}
            </mat-option>
          </mat-select>
        </div>
      </div>
    </form>
    <div  *ngIf="!evals || evals.length === 0"
    class="flex flex-row w-full mt-3"
    style="justify-content: center; align-items: center"
  >
    <span>No Student Evaluation Selected for {{("ILA" | labelReplacement)| async}}</span>
  </div>
    <app-input-error *ngIf="evalForm.invalid && (evals && evals.length > 0)" text="Please Select an Evaluation"></app-input-error>
    <app-data-loader *ngIf="hideChart"></app-data-loader>
    <div *ngIf="!evalForm.invalid && dataSourceEval && dataSourceEval.data.length < 1" class="flex w-full my-5" style="align-items:center;justify-content:center;">
      <span>No Students Enrolled In Roster</span>
    </div>
    <div *ngIf="!evalForm.invalid && !hideChart && dataSourceEval && dataSourceEval.data.length > 0" class="flex flex-row">
      <ng-container>
        <div
          class="
            flex flex-row
            bg-white
            rounded
            mt-3
            mr-3
            pt-3
            pl-3
            shadow-sm
            w-fit
            mb-4
          "
          style="width: 50%; align-items: center; justify-content: center"
        >
          <div style="display: block">
            <canvas *ngIf="!hideChart" #pie
              baseChart
              [type]="'pie'"
              [data]="pieChartData"
              [labels]="pieChartLabels"
              [options]="pieChartOptions"
              [plugins]="pieChartPlugins"
              [legend]="pieChartLegend"
            >
            </canvas>
          </div>
        </div>
        <div
          class="
            flex flex-row
            bg-white
            rounded
            mt-3
            pt-3
            pl-3
            shadow-sm
            w-fit
            mb-4
          "
          style="width: 50%; align-items: center; justify-content: center"
        >
          <div style="display: block">
            <canvas *ngIf="!hideChart"
              baseChart
              [data]="barChartData"
              [options]="barChartOptions"
              [plugins]="barChartPlugins"
              [legend]="barChartLegend"
              [type]="'bar'"
            >
            </canvas>
          </div>
        </div>
      </ng-container>
    </div>
    <div *ngIf="!evalForm.invalid">
      <div class="flex mt-4">
        <table
          [dataSource]="dataSourceEval"
          mat-table
          matSort
          style="border: 1px solid #e5e7eb"
          class="w-full"
        >

          <ng-container matColumnDef="employee">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{("Employee" | labelReplacement)| async}}
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="flex flex-row" style="align-items:center;">
                <img
                style="border-radius: 50%; width: 50px; height: 50px"
                class="img-fluid mr-2 mt-2 ml-2 mb-2"
                [src]="row.empImage"
                onerror="this.src='assets/img/ImageNotFound.jpg'"
              />
                <div class="flex flex-col">
                  <span style="line-break:anywhere;">{{row.empName}}</span>
                  <span style="line-break:anywhere;">{{row.empEmail}}</span>
                </div>
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="releaseDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              Release Date
            </th>
            <td mat-cell *matCellDef="let row">
              {{ row.releaseDate === null ? 'N/A':  (row.releaseDate | dateFormat | async)}}
            </td>
          </ng-container>
          <ng-container matColumnDef="completionDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              Completed Date
            </th>
            <td mat-cell *matCellDef="let row">
              {{ row.completedDate === null ? 'N/A':  (row.completedDate | dateFormat | async)}}
            </td>
          </ng-container>
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="flex flex-row items-center text-gray-four btn-group">
                <button [disabled]="disableAll" mat-icon-button [matMenuTriggerFor]="menu">
                  <app-icon icon="more_horiz"></app-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <label (click)="openRecallDialog(recallOrReleaseDialog,row)" [disabled]="!row.isReleased" mat-menu-item>Recall Student Evaluation </label>
                  <label (click)="openReleaseDialog(recallOrReleaseDialog,row)" [disabled]="row.isReleased" mat-menu-item>Release Student Evaluation</label>
                </mat-menu>
                <!-- </mat-menu> -->
              </div>
            </td>
          </ng-container>
          <tr mat-header-row
            *matHeaderRowDef="displayedEvaluationColumns"
          ></tr>
          <tr mat-row
            *matRowDef="let row; columns: displayedEvaluationColumns"
          ></tr>

          <!-- Row shown when there is no matching data.-->
          <tr class="mat-row text-center" *matNoDataRow>
            <td [colSpan]="displayedEvaluationColumns.length" class="mat-cell w-full m-2">No data matching the filter</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<ng-template #recallOrReleaseDialog>
    <app-qtd-dialogue
    [header]="header"
    [description]="description"
    [isHTML]="true"
    [cancelText]="'No'"
    [confirmText]="'Yes'"
    (confirmed)="releaseOrRecall()"
    (canceled)="dialog.closeAll()"
    ></app-qtd-dialogue>
</ng-template>
