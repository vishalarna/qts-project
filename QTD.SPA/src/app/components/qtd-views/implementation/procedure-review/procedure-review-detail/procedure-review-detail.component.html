<app-header title="" [canGoBack]="false"></app-header>
<div class="flex w-full justify-between">
  <div (click)="goBack()" class="flex ml-4 cursor-pointer" style="align-items: center;">
    <app-icon class="linkText" icon="keyboard_arrow_left"></app-icon>
    <span class="linkText ml-2">Back To {{("Procedure" | labelReplacement)| async}} Review</span>
  </div>
  <div class="flex flex-row justify-end flex-wrap ml-8 mt-3 mr-4">
    <app-button text="Enroll {{('Employee' | labelReplacement)| async}}" size="sm" icon="add" [disabled]="this.datePipe.transform(procedureReviewObject?.endDateTime, 'yyyy-MM-dd') < currentDate"
    (clicked)="openFlyInPanelAddEmployee(editRoaster)" iconPosition="left"
    class="float-right"></app-button>
  </div>
</div>
<div class="flex flex-row flex-wrap ml-8 mt-3 mr-4">
  <app-data-loader *ngIf="procedureReviewSpinner"></app-data-loader>
  <ng-container *ngIf="!procedureReviewSpinner">
    <div class="container bg-white rounded  pt-3 shadow-sm w-full mb-4">
      <div class="flex flex-row ">
        <div class="flex flex-col" style="width:10vw ;">
          <p style="color:#8b908e">{{("Procedure" | labelReplacement)| async}} Review Title :</p>
          <span><b>{{ procedureReviewObject === null || procedureReviewObject?.procedureReviewTitle === null || procedureReviewObject?.procedureReviewTitle === undefined ? "N/A" : procedureReviewObject?.procedureReviewTitle }}</b></span>
        </div>
        <div class="flex flex-col" style="width:25vw ;">
          <p style="color:#8b908e">Release Date:</p>
          <span ><b> {{procedureReviewObject === null || procedureReviewObject?.startDateTime === undefined ? "N/A" : this.datePipe.transform(convertUtcToLocalDate(procedureReviewObject?.startDateTime), 'yyyy-MM-dd hh:mm a') }}</b></span>

        </div>
        <div class="flex flex-col" style="width:25vw ;">
          <p style="color:#8b908e">Due Date :</p>
          <span ><b>{{procedureReviewObject === null || procedureReviewObject?.endDateTime === undefined ? "N/A" : this.datePipe.transform(convertUtcToLocalDate(procedureReviewObject?.endDateTime), 'yyyy-MM-dd hh:mm a') }} </b></span>

        </div>
      </div>

    </div>
  </ng-container>


</div>
<div class="flex flex-row flex-wrap ml-8 mt-3 mr-4">
  <p class="font-bold text-lg ">Overview</p>
</div>
<!-- <app-data-loader ></app-data-loader>

    <div class="flex w-full mt-5" style="align-items:center; justify-content: center;" >
      No Employee Enrolled In Roster
    </div>
      <app-data-loader *ngIf="hideChart"></app-data-loader> -->
<div *ngIf="!hideChart" class="flex flex-row flex-wrap ml-8 mt-3 mb-12 mr-4">
  <ng-container>
    <div class="
              flex flex-row
              bg-white
              rounded
              mt-3
              mr-3
              pt-3
              pl-3
              shadow-sm
              w-fit
              mb-4
            " style="width: 50%; align-items: center; justify-content: center">
      <div style="display: block">
        <canvas *ngIf="!hideChart" #pie baseChart [type]="'pie'" [data]="pieChartData" [labels]="pieChartLabels"
          [options]="pieChartOptions" [plugins]="pieChartPlugins" [legend]="pieChartLegend">
        </canvas>
      </div>
    </div>

  </ng-container>


  <div  class="flex flex-col">
    <div class="flex mt-4" style="width: 100%;">


      <div  *ngIf="dataSourceProcedureReview" style="width: 100%;">
          <div class="rounded-t-md py-4 space-x-2" *ngIf="selection.selected.length > 0">
              <mat-toolbar class="h-28 app-toolbar-sticky w-full">
                  <div class="flex flex-row items-center space-x-4 w-full justify-between">
                      <span class="text-sm">
                          {{ selection.selected.length }} ('Employee' | labelReplacement | async) has been selected
                      </span>
                      <div class="flex flex-row space-x-4 m-3 text-sm float-right">
                          <!-- <app-button color="secondary" text="Remove" size="sm"> </app-button> -->
                          <app-button color="secondary" (clicked)="removeDialog(deleteDialog)" text="Remove {{('Employee' | labelReplacement)| async}}s" size="sm" icon="delete"
                              iconPosition="left">
                          </app-button>
                      </div>
                  </div>
              </mat-toolbar>
          </div>
          <div class="border-gray-one shadow-xs border-0.5 rounded mat-elevation-z8" >
              <!-- search and buttons starts -->
              <!-- table starts -->
              <div class="flex-row bg-white-one rounded-b-md m-2 ">

                <table [dataSource]="dataSourceProcedureReview" mat-table matSort style="border: 1px solid #e5e7eb" class="w-full">

                  <ng-container matColumnDef="index">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? toggleAllRows() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-3">
                        <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null"
                            [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                        </mat-checkbox>
                    </td>
                </ng-container>
                  <ng-container matColumnDef="employee">
                    <th  mat-header-cell *matHeaderCellDef mat-sort-header>
                      {{("Employee" | labelReplacement)| async}}
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-18">
                      <div class="flex flex-row" style="align-items:center;">
                        <img style="border-radius: 50%; width: 50px; height: 50px" class="img-fluid mr-2 mt-2 ml-2 mb-2"
                          [src]="row.employeeImage" onerror="this.src='assets/img/ImageNotFound.jpg'" />
                        <div class="flex flex-col">
                          <span style="line-break:anywhere;">{{row.employeeName}}</span>
                          <span style="line-break:anywhere;">{{row.employeeEmail}}</span>
                        </div>
                      </div>
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="position">
                    <th  mat-header-cell *matHeaderCellDef mat-sort-header>
                      {{("Position" | labelReplacement)| async}}
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-18">
                      {{ row.employeePosition === null ? "N/A" : row.employeePosition  }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="organization">
                    <th  mat-header-cell *matHeaderCellDef mat-sort-header>
                      Organization
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-8">
                      {{ row.employeeOrganization === null ? "N/A" : row.employeeOrganization  }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="status">
                    <th  mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">
                      {{("Procedure" | labelReplacement)| async}} Review Status
                    </th>
                    <td mat-cell *matCellDef="let row" class="status-mat-chip-list text-center w-8">
                      <mat-chip-list >
                        <mat-chip style="background-color: #fff9e8;color: #ffcf5c;border-radius: 2px;" *ngIf="row.status==='Not Started'">
                            Not Started
                        </mat-chip>
                        <mat-chip style="background-color: #eef7ff;color: #80b264;border-radius: 2px;" *ngIf="row.status==='Completed'">
                          Completed
                       </mat-chip>
                       <mat-chip style="background-color: #fff9e8;color: #ffcf5c;border-radius: 2px;" *ngIf="row.status==='In Progress'">
                         In Progress
                       </mat-chip>
                    </mat-chip-list>
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="procedureReviewResponse">
                    <th  mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">
                      {{("Procedure" | labelReplacement)| async}} Review Response
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-8">
                        <div style="width:70%;align-items: center;" class="flex flex-row mat-elevation-z3 p-2"  *ngIf="editType === 'grade' && editId === row.empId">

                          <mat-form-field  style="outline:none;" class="w-full">
                            <mat-select placeholder="Select response" [(ngModel)]="valueToSave" [value]="row.response === null || row.response === '' ? '':row.response">
                                <mat-option [value]="'true'">
                                  true
                                </mat-option>
                                <mat-option [value]="'false'">
                                  false
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <app-button  [disabled]="isSaving" (clicked)="updateValue();"  ButtonType="icon" icon="check" class="mx-3 linkText"></app-button>
                          <mat-icon class="linkText"  (click)="editType = 'none';editId = '';">close</mat-icon>
                        </div>
                        <div style="text-align: center;" class="cursor-pointer" *ngIf="editType !== 'grade' || editId !== row.empId" (click)="editId = row.empId;editType = 'grade';valueToSave=row.response === null || row.response === '' ? '':row.response;">
                          {{ row.response === null || row.response === '' ? "N/A":row.response }}
                        </div>

                    </td>
                  </ng-container>
                  <ng-container matColumnDef="comments">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">
                      Comments</th>
                    <td mat-cell *matCellDef="let row" class="w-29">
                       <div style="width:70%;align-items: center;" class="flex flex-row mat-elevation-z3 p-2"  *ngIf="editType === 'score' && editId === row.empId">
                              <input [(ngModel)]="valueToSave" style="outline:none;" class="w-full" [value]="row.comments === null || row.comments === '' ? '':row.comments">
                              <app-button  [disabled]="isSaving" (clicked)="updateValue();"  ButtonType="icon" icon="check" class="mx-3 linkText"></app-button>
                              <mat-icon class="linkText"  (click)="editType = 'none';editId = '';">close</mat-icon>
                            </div>
                            <div style="width:fit-content;" class="cursor-pointer" *ngIf="editType !== 'score' || editId !== row.empId" (click)="editId = row.empId;editType = 'score';valueToSave=row.comments === null || row.comments === '' ? '':row.comments;">
                              {{ row.comments === null || row.comments === '' ? "N/A":row.comments }}
                            </div>
                      <!-- {{row.response}} -->
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="completedDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">
                      Completed Date</th>
                      <td mat-cell *matCellDef="let row" class="text-center w-8">
                        {{ row.completedDate === null ? "N/A" : this.datePipe.transform(row.completedDate, 'yyyy-MM-dd')  }}
                      </td>
                  </ng-container>

                  <ng-container matColumnDef="recall">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    </th>
                    <td mat-cell *matCellDef="let row">
                      <div style="padding: 0px 5px;">
                        <app-button [disabled]="row.status==='In Progress'" (clicked)="removeDialogSingle(deleteDialogSingle,row)"  size="sm" icon="delete"
                        iconPosition="left">
                    </app-button>
                      </div>
                      <!-- <mat-icon [matTooltip]="'These Options Are EMP Dependent'" [matMenuTriggerFor]="actions">more_horiz</mat-icon>
                      <mat-menu #actions backdropClass="qtd__menu">
                        <label mat-menu-item>Recall Test</label>
                      </mat-menu> -->
                    </td>
                  </ng-container>
                  <tr mat-header-row *matHeaderRowDef="displayedAllColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedAllColumns"></tr>

                  <!-- Row shown when there is no matching data.-->
                  <tr class="mat-row flex text-center" *matNoDataRow>
                    <td class="mat-cell w-full m-2">No data matching the filter</td>
                  </tr>
                </table>

              </div>
              <!-- table ends -->
          </div>
      </div>
    </div>
    </div>
</div>


<ng-template #deleteDialog>

  <mat-dialog-content>

      <!-- header starts here -->
      <div class="flex flex-row justify-between items-center mt-2">
          <p mat-dialog-title [textContent]="'Remove ' + (('Employee' | labelReplacement)| async)"></p>
          <!-- <app-textbox mat-dialog-title [(ngModel)]="header" [disabled]="true"></app-textbox> -->
          <app-button ButtonType='icon' icon="close" (clicked)="dialog.closeAll()"></app-button>

      </div>
      <hr class="mt-1 mb-8">
      <p>
        You are selecting to remove the following {{("Employee" | labelReplacement)| async}}s from the {{("Procedure" | labelReplacement)| async}}:
        {{ procedureReviewObject.procedureReviewTitle === undefined ? "N/A" :procedureReviewObject.procedureReviewTitle }} for System Operators. If the {{("Employee" | labelReplacement)| async}}s have not started the {{("Procedure" | labelReplacement)| async}} Review in EMP, un-enrolling the {{("Employee" | labelReplacement)| async}}s will recall the {{("Procedure" | labelReplacement)| async}} from EMP. If the {{("Employee" | labelReplacement)| async}}s have completed the {{("Procedure" | labelReplacement)| async}} review, un-enrolling the {{("Employee" | labelReplacement)| async}}s will remove all completion information.
      </p>
      <!--  <app-textbox [(ngModel)]="description" [disabled]="true"></app-textbox> -->
      <div class="flex flex-row justify-between mb-3" style="align-items: baseline;">
          <span class="mt-3">{{("Employee" | labelReplacement)| async}}s Selected</span>
          <span class="text-gray-400">{{this.selection.selected.length}}</span>
      </div>
      <div class="flex flex-row">
          <mat-chip-list *ngFor="let emp of this.selection.selected">
              <mat-chip>{{emp.employeeName}}</mat-chip>
          </mat-chip-list>

      </div>
<!--
      <div class="flex flex-row justify-between" *ngFor="let o of oldOrg">
          <p class="mt-3">Employees Selected</p>
          <mat-chip-list [disabled]="true">
              <mat-chip *ngFor="let item of filteredList">One fish</mat-chip>
          </mat-chip-list>
      </div> -->
      <p class="mt-3">Are you sure you want to continue?</p>
      <!-- header ends here -->
  </mat-dialog-content>


  <mat-dialog-actions class="flex flex-row justify-end">
      <!-- (clicked)="confirm()"
      (clicked)="cancel()" -->
      <app-button type="button" (clicked)="dialog.closeAll()"  color="grey" size="sm" class="mr-2">
      </app-button>
      <app-button type="button" (clicked)="removeEMP()" color="secondary" size="sm"[text]="'Yes'"
          class="mr-2" ></app-button>
  </mat-dialog-actions>
  <!-- <app-qtd-dialogue [header]="'Remove Employee'" [description]="" [confirmText]="'Yes'" [cancelText]="'No'"
      (canceled)="dialog.closeAll()" [showEffectiveDateAndReason]="false"
      (confirmed)="removeEMP()"></app-qtd-dialogue> -->
</ng-template>
<ng-template #deleteDialogSingle>

  <mat-dialog-content>

      <!-- header starts here -->
      <div class="flex flex-row justify-between items-center mt-2">
          <p mat-dialog-title [textContent]="'Remove ' + (('Employee' | labelReplacement)| async)"></p>
          <!-- <app-textbox mat-dialog-title [(ngModel)]="header" [disabled]="true"></app-textbox> -->
          <app-button ButtonType='icon' icon="close" (clicked)="dialog.closeAll()"></app-button>

      </div>
      <hr class="mt-1 mb-8">
      <p>
        You are selecting to remove {{("Employee" | labelReplacement)| async}} {{selectedEmpObject.employeeName}} from the selected {{("Procedure" | labelReplacement)| async}} review {{ procedureReviewObject.procedureReviewTitle === undefined ? "N/A" :procedureReviewObject.procedureReviewTitle }}
If the {{("Employee" | labelReplacement)| async}} has not started the {{("Procedure" | labelReplacement)| async}} Review in EMP, un-enrolling the {{("Employee" | labelReplacement)| async}} will recall the {{("Procedure" | labelReplacement)| async}} from EMP. If the {{("Employee" | labelReplacement)| async}} has completed the {{("Procedure" | labelReplacement)| async}} review, un-enrolling the {{("Employee" | labelReplacement)| async}} will remove all completion information.
 </p>

<!--
      <div class="flex flex-row justify-between" *ngFor="let o of oldOrg">
          <p class="mt-3">Employees Selected</p>
          <mat-chip-list [disabled]="true">
              <mat-chip *ngFor="let item of filteredList">One fish</mat-chip>
          </mat-chip-list>
      </div> -->
      <p class="mt-3">Are you sure you want to continue?</p>
      <!-- header ends here -->
  </mat-dialog-content>


  <mat-dialog-actions class="flex flex-row justify-end">
      <!-- (clicked)="confirm()"
      (clicked)="cancel()" -->
      <app-button type="button" (clicked)="dialog.closeAll()"  color="grey" size="sm" class="mr-2">
      </app-button>
      <app-button type="button" (clicked)="removeEMPSingle()" color="secondary" size="sm"[text]="'Yes'"
          class="mr-2" ></app-button>
  </mat-dialog-actions>
  <!-- <app-qtd-dialogue [header]="'Remove Employee'" [description]="" [confirmText]="'Yes'" [cancelText]="'No'"
      (canceled)="dialog.closeAll()" [showEffectiveDateAndReason]="false"
      (confirmed)="removeEMP()"></app-qtd-dialogue> -->
</ng-template>
<ng-template #editRoaster>

  <app-fly-panel-add-employee (closed)="flyPanelSrvc.close()">

  </app-fly-panel-add-employee>
</ng-template>
